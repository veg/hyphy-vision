webpackJsonp([0],{0:function(e,t,a){e.exports=a(1)},1:function(e,t,a){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}var n=a(5);t(n);window.$=window.JQuery=e,a(14),a(22),a(24),a(37),a(42);var r=a(203),s=a(221),i=a(222);window.absrel=r,window.busted=s,window.relax=i}).call(t,a(2))},5:function(e,t){},14:function(e,t){},22:function(e,t){},37:function(e,t,a){(function(a,n,r,s){"use strict";var i=function(){};"undefined"!=typeof e&&e.exports&&(t=e.exports=i),t.datamonkey=i,i.errorModal=function(e){a("#modal-error-msg").text(e),a("#errorModal").modal()},i.export_csv_button=function(e){if(e=n.csv.format(e),null!==e){var t=document.createElement("a");t.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","export.csv"),t.className="btn btn-default btn-sm",t.innerHTML='<span class="glyphicon glyphicon-floppy-save"></span> Download CSV',a("body").append(t),t.click(),t.remove()}},i.save_image=function(e,t){function n(e){function t(e){try{if(e.cssRules)for(var n=0;n<e.cssRules.length;n++){var r=e.cssRules[n];3===r.type?t(r.styleSheet):r.selectorText&&r.selectorText.indexOf(">")===-1&&(a+="\n"+r.cssText)}}catch(s){console.log("Could not process stylesheet : "+e)}}var a="",n=e.styleSheets;if(n)for(var r=0;r<n.length;r++)t(n[r]);return a}var r={xmlns:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"},s=function(e){var t=document.getElementById("hyphy-chart-image");t.onload=function(){var e=document.getElementById("hyphy-chart-canvas");e.width=t.width,e.height=t.height;var n=e.getContext("2d");n.fillStyle="#FFFFFF",n.fillRect(0,0,t.width,t.height),n.drawImage(t,0,0);var r=(e.toDataURL("image/png"),document.createElement("a"));r.setAttribute("download","image.png"),r.href=e.toDataURL("image/png"),a("body").append(r),r.click(),r.remove()},t.src=e},i=a(t).find("svg")[0];i||(i=a(t)[0]);var o=n(window.document);i.setAttribute("version","1.1");var l=document.createElement("defs");i.insertBefore(l,i.firstChild);var c=document.createElement("style");l.appendChild(c),c.setAttribute("type","text/css"),i.removeAttribute("xmlns"),i.removeAttribute("xlink"),i.hasAttributeNS(r.xmlns,"xmlns")||i.setAttributeNS(r.xmlns,"xmlns",r.svg),i.hasAttributeNS(r.xmlns,"xmlns:xlink")||i.setAttributeNS(r.xmlns,"xmlns:xlink",r.xlink);var m=(new XMLSerializer).serializeToString(i).replace("</style>","<![CDATA["+o+"]]></style>"),d=(i.getBoundingClientRect(),'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),u=[d+m],p="data:image/svg+xml;base66,"+encodeURIComponent(u);if("png"==e)s(p);else{var h=document.createElement("a");h.setAttribute("download","image.svg"),h.setAttribute("href",p),a("body").append(h),h.click(),h.remove()}},i.jobQueue=function(e){r.templateSettings={evaluate:/\{\%(.+?)\%\}/g,interpolate:/\{\{(.+?)\}\}/g,variable:"rc"},n.json("/jobqueue",function(t){var n=r.template(a("script.job-queue").html()),s=n(t);a("#job-queue-panel").find("table").remove(),a(e).append(s)})},i.status_check=function(){if(a(".status-checker").length){var e="/clusterhealth";n.json(e,function(e){e.successful_connection?(n.select(".status-checker").classed({"status-healthy":!0,"status-troubled":!1}),a(".status-checker").attr("title","Cluster Status : Healthy")):(n.select(".status-checker").classed({"status-healthy":!1,"status-troubled":!0}),a(".status-checker").attr("title","Cluster Status : Troubled; "+e.msg.description))})}},i.validate_date=function(){0===a(this).val().length?(a(this).next(".help-block").remove(),a(this).parent().removeClass("has-success"),a(this).parent().addClass("has-error"),s("<span/>",{"class":"help-block",text:"Field is empty"}).insertAfter(a(this))):isNaN(Date.parse(a(this).val()))?(a(this).next(".help-block").remove(),a(this).parent().removeClass("has-success"),a(this).parent().addClass("has-error"),s("<span/>",{"class":"help-block",text:"Date format should be in the format YYYY-mm-dd"}).insertAfter(a(this))):(a(this).parent().removeClass("has-error"),a(this).parent().addClass("has-success"),a(this).next(".help-block").remove())},a(document).ready(function(){a(function(){a('[data-toggle="tooltip"]').tooltip()}),a("#datamonkey-header").collapse();var e=a("body").css("padding-top");a("#collapse_nav_bar").on("click",function(t){a("#datamonkey-header").collapse("toggle"),a(this).find("i").toggleClass("fa-times-circle fa-eye");var r=a("body").css("padding-top")==e?"5px":e;n.select("body").transition().style("padding-top",r)})})}).call(t,a(2),a(38),a(41),a(2))},42:function(e,t,a){(function(e,t,n){"use strict";a(43),a(201),a(202);var r=a(44),s=a(37);r.createClass({displayName:"SLAC",float_format:e.format(".2f"),dm_loadFromServer:function(){var t=this;e.json(t.props.url,function(e,a){if(a)t.dm_initializeFromJSON(a);else{var n=404==e.status?t.props.url+" could not be loaded":e.statusText;t.setState({error_message:n})}})},dm_initializeFromJSON:function(e){this.setState({analysis_results:e})},getDefaultProps:function(){return{url:"#"}},getInitialState:function(){return{analysis_results:null,error_message:null,pValue:.1}},componentWillMount:function(){this.dm_loadFromServer(),this.dm_setEvents()},dm_setEvents:function(){var e=this;t("#datamonkey-json-file").on("change",function(a){var n=a.target.files;if(1==n.length){var r=n[0],s=new FileReader;s.onload=function(t){return function(t){try{e.dm_initializeFromJSON(JSON.parse(this.result))}catch(a){e.setState({error_message:a.toString()})}}}(r),s.readAsText(r)}t("#datamonkey-json-file-toggle").dropdown("toggle")})},dm_adjustPvalue:function(e){this.setState({pValue:parseFloat(e.target.value)})},render:function(){var e=this;return e.state.error_message?r.createElement("div",{id:"datamonkey-error",className:"alert alert-danger alert-dismissible",role:"alert"},r.createElement("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close"},r.createElement("span",{"aria-hidden":"true"},"×")),r.createElement("strong",null,e.state.error_message)," ",r.createElement("span",{id:"datamonkey-error-text"})):e.state.analysis_results?r.createElement("div",{className:"tab-content"},r.createElement("div",{className:"tab-pane",id:"summary_tab"},r.createElement("div",{className:"row"},r.createElement("div",{id:"summary-div",className:"col-md-12"},r.createElement(SLACBanner,{analysis_results:e.state.analysis_results,pValue:e.state.pValue,pAdjuster:n.bind(e.dm_adjustPvalue,e)}))),r.createElement("div",{className:"row hidden-print"},r.createElement("div",{id:"datamonkey-slac-tree-summary",className:"col-lg-4 col-md-6 col-sm-12"},r.createElement("div",{className:"panel panel-default"},r.createElement("div",{className:"panel-heading"},r.createElement("h3",{className:"panel-title"},r.createElement("i",{className:"fa fa-puzzle-piece"})," Partition information")),r.createElement("div",{className:"panel-body"},r.createElement("small",null,r.createElement(DatamonkeyPartitionTable,{pValue:e.state.pValue,trees:e.state.analysis_results.trees,partitions:e.state.analysis_results.partitions,branchAttributes:e.state.analysis_results["branch attributes"],siteResults:e.state.analysis_results.MLE,accessorPositive:function(e,t){return n.map(e.content[t]["by-site"].AVERAGED,function(e){return e[8]})},accessorNegative:function(e,t){return n.map(e.content[t]["by-site"].AVERAGED,function(e){return e[9]})}}))))),r.createElement("div",{id:"datamonkey-slac-model-fits",className:"col-lg-5 col-md-6 col-sm-12"},r.createElement("div",{className:"panel panel-default"},r.createElement("div",{className:"panel-heading"},r.createElement("h3",{className:"panel-title"},r.createElement("i",{className:"fa fa-table"})," Model fits")),r.createElement("div",{className:"panel-body"},r.createElement("small",null,r.createElement(DatamonkeyModelTable,{fits:e.state.analysis_results.fits}))))),r.createElement("div",{id:"datamonkey-slac-timers",className:"col-lg-3 col-md-3 col-sm-12"},r.createElement("div",{className:"panel panel-default"},r.createElement("div",{className:"panel-heading"},r.createElement("h3",{className:"panel-title"},r.createElement("i",{className:"fa fa-clock-o"})," Execution time")),r.createElement("div",{className:"panel-body"},r.createElement("small",null,r.createElement(DatamonkeyTimersTable,{timers:e.state.analysis_results.timers,totalTime:"Total time"}))))))),r.createElement("div",{className:"tab-pane active",id:"sites_tab"},r.createElement("div",{className:"row"},r.createElement("div",{id:"summary-div",className:"col-md-12"},r.createElement(SLACSites,{headers:e.state.analysis_results.MLE.headers,mle:s.helpers.map(s.helpers.filter(e.state.analysis_results.MLE.content,function(e,t){return n.has(e,"by-site")}),function(e,t){return e["by-site"]}),sample25:e.state.analysis_results["sample-2.5"],sampleMedian:e.state.analysis_results["sample-median"],sample975:e.state.analysis_results["sample-97.5"],partitionSites:e.state.analysis_results.partitions})))),r.createElement("div",{className:"tab-pane",id:"tree_tab"})):null}})}).call(t,a(38),a(2),a(41))},43:function(e,t,a){(function(e,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=a(44),s=a(37),i=r.createClass({displayName:"DatamonkeyTableRow",dm_compareTwoValues:function(t,a){var r="undefined"==typeof t?"undefined":n(t),s=this;if(r==("undefined"==typeof a?"undefined":n(a))){if("string"==r||"number"==r)return t==a?1:0;if(e.isArray(t)&&e.isArray(a)){if(t.length!=a.length)return 0;var i=0,o=e.every(t,function(e,t){var n=s.dm_compareTwoValues(e,a[t]);return n<0?(i=n,!1):1==n});return i<0?i:o?1:0}return-2}return-1},dm_log100times:e.before(100,function(e){return console.log(e),0}),shouldComponentUpdate:function(t){var a=this;if(this.props.header!==t.header)return!0;var n=e.some(this.props.rowData,function(n,r){if(n===t.rowData[r])return!1;var s=a.dm_compareTwoValues(n,t.rowData[r]);return s>=0?0==s:s!=-2||!e.has(n,"value")||!e.has(t.rowData[r],"value")||1!=a.dm_compareTwoValues(n.value,t.rowData[r].value)});return n&&this.dm_log100times(["Old",this.props.rowData,"New",t.rowData]),n},render:function(){return r.createElement("tr",null,this.props.rowData.map(e.bind(function(t,a){var n=e.has(t,"value")?t.value:t;if(e.isArray(n)){if(!e.has(t,"format"))return n}else if(e.isObject(n)&&!r.isValidElement(n))return null;e.has(t,"format")&&(n=t.format(n)),e.has(t,"abbr")&&(n=r.createElement("abbr",{title:t.abbr},n));var s={key:a};return e.has(t,"span")&&(s.colSpan=t.span),e.has(t,"style")&&(s.style=t.style),e.has(t,"classes")&&(s.className=t.classes),r.createElement(this.props.header?"th":"td",s,n)},this)))}}),o=r.createClass({displayName:"DatamonkeyTable",getDefaultProps:function(){return{classes:"table table-condensed table-hover",rowHash:null,sortableColumns:new Object(null),initialSort:null}},getInitialState:function(){return{sortedOn:this.props.initialSort}},render:function(){var t=[];return this.props.headerData&&(e.isArray(this.props.headerData[0])?t.push(r.createElement("thead",{key:0},e.map(this.props.headerData,function(e,t){return r.createElement(i,{rowData:e,header:!0,key:t})}))):t.push(r.createElement("thead",{key:0},r.createElement(i,{rowData:this.props.headerData,header:!0})))),t.push(r.createElement("tbody",{key:1},e.map(this.props.bodyData,e.bind(function(e,t){return r.createElement(i,{rowData:e,key:this.props.rowHash?this.props.rowHash(e):t,header:!1})},this)))),r.createElement("table",{className:this.props.classes},t)}}),l=r.createClass({displayName:"DatamonkeyRateDistributionTable",propTypes:{distribution:r.PropTypes.object.isRequired},dm_formatterRate:t.format(".3r"),dm_formatterProp:t.format(".3p"),dm_createDistributionTable:function(t){var a=[],n=this;return e.each(t,function(t,r){a.push([{value:r,span:3,classes:"info"}]),e.each(t,function(e,t){a.push([{value:e[1],format:n.dm_formatterProp},"@",{value:e[0],format:n.dm_formatterRate}])})}),a},render:function(){return r.createElement(o,{bodyData:this.dm_createDistributionTable(this.props.distribution),classes:"table table-condensed"})}});r.createClass({displayName:"DatamonkeyPartitionTable",dm_formatterFloat:t.format(".3r"),dm_formatterProp:t.format(".3p"),propTypes:{trees:r.PropTypes.object.isRequired,partitions:r.PropTypes.object.isRequired,branchAttributes:r.PropTypes.object.isRequired,siteResults:r.PropTypes.object.isRequired,accessorNegative:r.PropTypes.func.isRequired,accessorPositive:r.PropTypes.func.isRequired,pValue:r.PropTypes.number.isRequired},dm_computePartitionInformation:function(t,a,n,r){var i=e.sortBy(e.keys(a),function(e){return e}),o=null,l=this,c=this.props.extractOn||e.find(n.attributes,function(e,t){return o=t,"branch length"==e["attribute type"]});return o&&(c=o),e.map(i,function(i,o){var m=t.tested[i],d={};e.each(m,function(e,t){"test"==e&&(d[t]=1)});var u=c?s.helpers.sum(n[i],function(e,t){return d[t.toUpperCase()]?e[c]:0}):0,p=c?s.helpers.sum(n[i],function(e){return e[c]||0}):0;return e.map([o+1,a[i].coverage[0].length,e.size(d),e.keys(m).length,u,u/p,p,e.filter(l.props.accessorPositive(l.props.siteResults,i),function(e){return e<=r}).length,e.filter(l.props.accessorNegative(l.props.siteResults,i),function(e){return e<=r}).length],function(t,a){if(a>1){var n={value:t,style:{textAlign:"center"}};return 4!=a&&6!=a||e.extend(n,{format:l.dm_formatterFloat}),5==a&&e.extend(n,{format:l.dm_formatterProp}),n}return t})})},dm_makeHeaderRow:function(t){return[e.map(["Partition","Sites","Branches","Branch Length","Selected at p"+String.fromCharCode(parseInt("2264",16))+t],function(t,a){return e.extend({value:t,style:{borderBottom:0,textAlign:a>1?"center":"left"}},a>1?{span:3==a?3:2}:{})}),e.map(["","","Tested","Total","Tested","% of total","Total","Positive","Negative"],function(e,t){return{value:e,style:{borderTop:0,textAlign:t>1?"center":"left"}}})]},getInitialState:function(){return{header:this.dm_makeHeaderRow(this.props.pValue),rows:this.dm_computePartitionInformation(this.props.trees,this.props.partitions,this.props.branchAttributes,this.props.pValue)}},componentWillReceiveProps:function(e){this.setState({header:this.dm_makeHeaderRow(e.pValue),rows:this.dm_computePartitionInformation(e.trees,e.partitions,e.branchAttributes,e.pValue)})},render:function(){return r.createElement("div",{className:"table-responsive"},r.createElement(o,{headerData:this.state.header,bodyData:this.state.rows}))}}),r.createClass({displayName:"DatamonkeyModelTable",dm_numberFormatter:t.format(".2f"),dm_supportedColumns:{"log likelihood":{order:2,value:{value:"log L",abbr:"log likelihood"},display_format:t.format(".2f")},parameters:{order:3,value:"Parameters"},"AIC-c":{order:1,value:{value:r.createElement("span",null,["AIC",r.createElement("sub",{key:"0"},"C")]),abbr:"Small-sample corrected Akaike Information Score"},display_format:t.format(".2f")},"rate distributions":{order:4,value:"Rate distributions",transform:function(e){return r.createElement(l,{distribution:e})}}},propTypes:{fits:r.PropTypes.object.isRequired},getDefaultProps:function(){return{orderOn:"display order"}},dm_extractFitsTable:function(t){var a=null,n=[],r={},s={},i=[],o=this;return e.each(t,function(t,l){a||(a={},e.each(t,function(t,i){o.dm_supportedColumns[i]&&(a[i]=o.dm_supportedColumns[i],n[a[i].order]=i,r[i]=o.dm_supportedColumns[i].display_format,e.isFunction(o.dm_supportedColumns[i].transform)&&(s[i]=o.dm_supportedColumns[i].transform))}),n=e.filter(n,function(e){return e}));var c=[{value:l,style:{fontVariant:"small-caps"}}];e.each(n,function(e){var a=s[e]?s[e](t[e]):t[e];r[e]?c.push({value:a,format:r[e]}):c.push(a)}),i.push([c,e.isNumber(t[o.props.orderOn])?t[o.props.orderOn]:i.length])}),{data:e.map(e.sortBy(i,function(e){return e[1]}),function(e){return e[0]}),columns:e.map(n,function(e){return a[e].value})}},dm_makeHeaderRow:function(t){var a=["Model"];return e.each(t,function(e){a.push(e)}),a},getInitialState:function(){var e=this.dm_extractFitsTable(this.props.fits);return{header:this.dm_makeHeaderRow(e.columns),rows:e.data,caption:null}},render:function(){return r.createElement("div",{className:"table-responsive"},r.createElement(o,{headerData:this.state.header,bodyData:this.state.rows}))}}),r.createClass({displayName:"DatamonkeyTimersTable",dm_percentageFormatter:t.format(".2%"),propTypes:{timers:r.PropTypes.object.isRequired},dm_formatSeconds:function(t){var a=[~~(t/3600),~~(t%3600/60),t%60];return e.map(a,function(e){return e<10?"0"+e:""+e}).join(":")},dm_extractTimerTable:function(t){var a=0,n=e.map(t,e.bind(function(e,t){return this.props.totalTime?t==this.props.totalTime&&(a=e.timer):a+=e.timer,[t,e.timer,e.order]},this));return n=e.sortBy(n,function(e){return e[2]}),n=e.map(n,e.bind(function(e){return null===this.props.totalTime||this.props.totalTime!=e[0]?e[2]={value:e[1]/a,format:this.dm_percentageFormatter}:e[2]="",e[1]=this.dm_formatSeconds(e[1]),e},this))},dm_makeHeaderRow:function(){return["Task","Time","%"]},getInitialState:function(){return{header:this.dm_makeHeaderRow(),rows:this.dm_extractTimerTable(this.props.timers),caption:null}},render:function(){return r.createElement(o,{headerData:this.state.header,bodyData:this.state.rows})}})}).call(t,a(41),a(38))},201:function(e,t,a){(function(e,t){"use strict";var n=a(44),r=a(37);n.createClass({displayName:"SLACSites",propTypes:{headers:n.PropTypes.arrayOf(n.PropTypes.arrayOf(n.PropTypes.string)).isRequired,mle:n.PropTypes.object.isRequired,sample25:n.PropTypes.object,sampleMedian:n.PropTypes.object,sample975:n.PropTypes.object,initialAmbigHandling:n.PropTypes.string.isRequired,partitionSites:n.PropTypes.object.isRequired},getInitialState:function(){var e=this.props.sample25&&this.props.sampleMedian&&this.props.sample975;return{ambigOptions:this.dm_AmbigOptions(this.props),ambigHandling:this.props.initialAmbigHandling,filters:new Object(null),showIntervals:e,hasCI:e}},getDefaultProps:function(){return{sample25:null,sampleMedian:null,sample975:null,initialAmbigHandling:"RESOLVED"}},componentWillReceiveProps:function(e){this.setState({ambigOptions:this.dm_AmbigOptions(e),ambigHandling:e.initialAmbigHandling})},dm_formatNumber:e.format(".3r"),dm_formatNumberShort:e.format(".2r"),dm_log10times:t.before(10,function(e){return console.log(e),0}),dm_formatInterval:function(e){return this.dm_formatNumber(e[0])+" / "+this.dm_formatNumber(e[2])+" ["+this.dm_formatNumber(e[1])+" : "+this.dm_formatNumber(e[3])+"]"},dm_AmbigOptions:function(e){return t.keys(e.mle[0])},dm_changeAmbig:function(e){this.setState({ambigHandling:e.target.value})},dm_toggleIntervals:function(e){this.setState({showIntervals:!this.state.showIntervals})},dm_toggleVariableFilter:function(e){var a=new Object(null);t.extend(a,this.state.filters),a.variable="on"==this.state.filters.variable?"off":"on",this.setState({filters:a})},dm_makeFilterFunction:function(){var e=null;return t.each(this.state.filters,function(a,n){var r=null;switch(n){case"variable":"on"==a&&(r=function(e,t,a,n,r){return(!e||e(t,a,n,r))&&r[2]+r[3]>0})}r&&(e=t.wrap(e,r))}),e},dm_makeHeaderRow:function(){var e=["Partition","Site"],a=this.state.showIntervals;if(a){var n=["",""];return t.each(this.props.headers,function(t){e.push({value:t[0],abbr:t[1],span:4,style:{textAlign:"center"}}),n.push("MLE"),n.push("Med"),n.push("2.5%"),n.push("97.5%")}),[e,n]}return t.each(this.props.headers,function(t){e.push({value:t[0],abbr:t[1]})}),e},dm_makeDataRows:function(e){for(var a=[],n=r.helpers.countPartitionsJSON(this.props.partitionSites),s=0,i=this,o=this.state.showIntervals;s<n;)t.each(i.props.partitionSites[s].coverage[0],function(n,r){var l=i.props.mle[s][i.state.ambigHandling][r];if(!e||e(s,r,n,l)){var c=[s+1,n+1];t.each(l,function(e,t){o?(c.push({value:e,format:i.dm_formatNumber}),c.push({value:i.props.sample25[s][i.state.ambigHandling][r][t],format:i.dm_formatNumberShort}),c.push({value:i.props.sampleMedian[s][i.state.ambigHandling][r][t],format:i.dm_formatNumberShort}),c.push({value:i.props.sample975[s][i.state.ambigHandling][r][t],format:i.dm_formatNumberShort})):c.push({value:e,format:i.dm_formatNumber})}),a.push(c)}}),s++;return a},render:function(){var e=this,a=n.createElement("div",{className:"table-responsive"},n.createElement("form",{className:"form-inline navbar-form navbar-left"},n.createElement("div",{className:"form-group"},n.createElement("div",{className:"btn-group"},n.createElement("button",{className:"btn btn-default btn-sm dropdown-toggle",type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"Display Options ",n.createElement("span",{className:"caret"})),n.createElement("ul",{className:"dropdown-menu"},n.createElement("li",{key:"variable"},n.createElement("div",{className:"checkbox"},n.createElement("input",{type:"checkbox",checked:"on"==e.state.filters.variable,defaultChecked:"on"==e.state.filters.variable,onChange:e.dm_toggleVariableFilter})," Variable sites only")),e.state.hasCI?n.createElement("li",{key:"intervals"},n.createElement("div",{className:"checkbox"},n.createElement("input",{type:"checkbox",checked:e.state.showIntervals,defaultChecked:e.state.showIntervals,onChange:e.dm_toggleIntervals})," Show sampling confidence intervals")):null)),n.createElement("div",{className:"input-group"},n.createElement("div",{className:"input-group-addon"},"Ambiguities are "),n.createElement("select",{className:"form-control input-sm",defaultValue:e.state.ambigHandling,onChange:e.dm_changeAmbig},t.map(this.state.ambigOptions,function(e,t){return n.createElement("option",{key:t,value:e},e)}))))),n.createElement(DatamonkeyTable,{headerData:this.dm_makeHeaderRow(),bodyData:this.dm_makeDataRows(this.dm_makeFilterFunction())}));return a}})}).call(t,a(38),a(41))},202:function(e,t,a){(function(e,t){"use strict";var n=a(44),r=a(37);n.createClass({displayName:"SLACBanner",dm_countSites:function(t,a){var n={all:0,positive:0,negative:0};return n.all=r.helpers.countSitesFromPartitionsJSON(t),n.positive=r.helpers.sum(t.MLE.content,function(t){return e.reduce(t["by-site"].RESOLVED,function(e,t){return e+(t[8]<=a?1:0)},0)}),n.negative=r.helpers.sum(t.MLE.content,function(t){return e.reduce(t["by-site"].RESOLVED,function(e,t){return e+(t[9]<=a?1:0)},0)}),n},dm_computeState:function(e,t){return{sites:this.dm_countSites(e,t)}},dm_formatP:t.format(".3f"),getInitialState:function(){return this.dm_computeState(this.props.analysis_results,this.props.pValue)},componentWillReceiveProps:function(e){this.setState(this.dm_computeState(e.analysis_results,e.pValue))},render:function(){return n.createElement("div",{className:"panel panel-primary"},n.createElement("div",{className:"panel-heading"},n.createElement("h3",{className:"panel-title"},n.createElement("abbr",{title:"Single Likelihood Ancestor Counting"},"SLAC")," analysis summary")),n.createElement("div",{className:"panel-body"},n.createElement("span",{className:"lead"},"Evidence",n.createElement("sup",null,"†")," of pervasive ",n.createElement("span",{className:"hyphy-red"},"diversifying")," / ",n.createElement("span",{className:"hyphy-navy"},"purifying")," selection was found at",n.createElement("strong",{className:"hyphy-red"}," ",this.state.sites.positive)," / ",n.createElement("strong",{className:"hyphy-navy"},this.state.sites.negative)," sites among ",this.state.sites.all," tested sites"),n.createElement("div",{style:{marginBottom:"0em"}},n.createElement("small",null,n.createElement("sup",null,"†"),"Extended binomial test, p ≤ ",this.dm_formatP(this.props.pValue),n.createElement("div",{className:"dropdown hidden-print",style:{display:"inline",marginLeft:"0.25em"}},n.createElement("button",{id:"dm.pvalue.slider",type:"button",className:"btn btn-primary btn-xs dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},n.createElement("span",{className:"caret"})),n.createElement("ul",{className:"dropdown-menu","aria-labelledby":"dm.pvalue.slider"},n.createElement("li",null,n.createElement("a",{href:"#"},n.createElement("input",{type:"range",min:"0",max:"1",value:this.props.pValue,step:"0.01",onChange:this.props.pAdjuster}))))),n.createElement("emph",null," not")," corrected for multiple testing; ambiguous characters resolved to minimize substitution counts.",n.createElement("br",null),n.createElement("i",{className:"fa fa-exclamation-circle"})," Please cite ",n.createElement("a",{href:"http://www.ncbi.nlm.nih.gov/pubmed/15703242",target:"_blank"},"PMID 15703242")," if you use this result in a publication, presentation, or other scientific work."))))}})}).call(t,a(41),a(38))},203:function(e,t,a){(function(t,n){"use strict";function r(e,t){m.render(m.createElement(u,{url:e}),document.getElementById(t))}var s=a(204),i=a(205),o=a(206),l=a(207),c=a(209),m=a(44),d=(a(211),a(37),a(41));a(212);a(208),a(219);var m=a(44),u=m.createClass({displayName:"BSREL",float_format:t.format(".2f"),loadFromServer:function(){var e=this;t.json(this.props.url,function(t){t.fits.MG94["branch-annotations"]=e.formatBranchAnnotations(t,"MG94"),t.fits["Full model"]["branch-annotations"]=e.formatBranchAnnotations(t,"Full model"),t.fits.MG94["annotation-tag"]="ω",t.fits["Full model"]["annotation-tag"]="ω";var a=t.fits["Full model"]["branch-annotations"],n=t,r=t.PMID,s=t["test results"];e.setState({annotations:a,json:n,pmid:r,test_results:s})})},getDefaultProps:function(){var e=function(e,a){var r=this,s=t.select("#tree_container svg"),i=t.select(".phylotree-definitions");i.empty()&&(i=s.append("defs").attr("class","phylotree-definitions"));var o=1/3,l=t.format(".3r"),c=t.format(".2p");t.format(".2f"),t.format(".4f");r.omega_color=t.scale.pow().exponent(o).domain([0,.25,1,5,10]).range(r.options()["color-fill"]?["#DDDDDD","#AAAAAA","#888888","#444444","#000000"]:["#6e4fa2","#3288bd","#e6f598","#f46d43","#9e0142"]).clamp(!0);var m=function(e){function t(e,t,a,n){var s=0,i=e.append("linearGradient").attr("id",t);a.forEach(function(e,t){if(e.prop){var a=s+e.prop;i.append("stop").attr("offset",""+100*s+"%").style("stop-color",r.omega_color(e.omega)),i.append("stop").attr("offset",""+100*a+"%").style("stop-color",r.omega_color(e.omega)),s=a}})}if(void 0==r.gradient_count&&(r.gradient_count=0),e.annotations)if(1==e.annotations.length)e.color=r.omega_color(e.annotations[0].omega);else{r.gradient_count++;var a="branch_gradient_"+r.gradient_count;t(i,a,e.annotations.omegas),e.grad=a}},d=a.target.annotations,u=.05,p="<b>"+a.target.name+"</b>",h=c(0),f="";d&&(h=d.omegas[0].prop,d.omegas.forEach(function(e,t){var a=e.omega>1e20?"&infin;":l(e.omega),n=c(e.prop);p+="<br/>&omega;<sub>"+(t+1)+"</sub> = "+a+" ("+n+")",t&&(f+="<br/>"),f+="&omega;<sub>"+(t+1)+"</sub> = "+a+" ("+n+")"}),p+="<br/><i>p = "+l(d.p)+"</i>",n(e[0][0]).tooltip({title:p,html:!0,trigger:"hover",container:"body",placement:"auto"}),m(a.target),a.target.grad?e.style("stroke","url(#"+a.target.grad+")"):e.style("stroke",a.target.color),e.style("stroke-width",d.p<=u?"12":"5").style("stroke-linejoin","round").style("stroke-linecap","round"))};return{edgeColorizer:e}},getInitialState:function(){var e={omegaPlot:{},"tree-options":{"hyphy-tree-model":["Full model",!0],"hyphy-tree-highlight":[null,!1],"hyphy-tree-branch-lengths":[!0,!0],"hyphy-tree-hide-legend":[!1,!0],"hyphy-tree-fill-color":[!1,!0]},"suppress-tree-render":!1,"chart-append-html":!0,edgeColorizer:this.props.edgeColorizer};return{annotations:null,json:null,pmid:null,settings:e,test_results:null,tree:null}},componentWillMount:function(){this.loadFromServer(),this.setEvents()},setEvents:function(){var e=this;n("#datamonkey-absrel-json-file").on("change",function(t){var a=t.target.files;if(1==a.length){var r=a[0],s=new FileReader;s.onload=function(t){return function(t){var a=JSON.parse(this.result);a.fits.MG94["branch-annotations"]=e.formatBranchAnnotations(a,"MG94"),a.fits["Full model"]["branch-annotations"]=e.formatBranchAnnotations(a,"Full model");var n=a.fits["Full model"]["branch-annotations"],r=a,s=a.PMID,i=a["test results"];e.setState({annotations:n,json:r,pmid:s,test_results:i})}}(r),s.readAsText(r)}n("#datamonkey-absrel-toggle-here").dropdown("toggle"),t.preventDefault()})},formatBranchAnnotations:function(e,t){var a=e.fits[t]["branch-annotations"];a||(a=e.fits[t]["rate distributions"]);var n=d.mapObject(a,function(t,a){var n=[];try{n=JSON.parse(t)}catch(r){n=t}var s={omegas:d.map(n,function(e){return d.object(["omega","prop"],e)})},i=d.clone(e["test results"][a]);return d.extend(i,s),i});return n},initialize:function(){},render:function(){var e=this;return m.createElement("div",{className:"tab-content"},m.createElement("div",{className:"tab-pane active",id:"summary-tab"},m.createElement("div",{className:"row"},m.createElement("div",{id:"summary-div",className:"col-md-12"},m.createElement(s.BSRELSummary,{test_results:e.state.test_results,pmid:e.state.pmid}))),m.createElement("div",{className:"row"},m.createElement("div",{id:"hyphy-tree-summary",className:"col-md-6"},m.createElement(o.TreeSummary,{json:e.state.json})),m.createElement("div",{id:"hyphy-model-fits",className:"col-md-6"},m.createElement(i.ModelFits,{json:e.state.json})))),m.createElement("div",{className:"tab-pane",id:"tree-tab"},m.createElement(l.Tree,{json:e.state.json,settings:e.state.settings})),m.createElement("div",{className:"tab-pane",id:"table_tab"},m.createElement(c.BranchTable,{tree:e.state.tree,test_results:e.state.test_results,annotations:e.state.annotations})))}});e.exports=r}).call(t,a(38),a(2))},204:function(e,t,a){(function(t,n){"use strict";function r(e,t,a){s.render(s.createElement(i,{test_results:e,pmid:t}),document.getElementById(a))}var s=a(44),i=s.createClass({displayName:"BSRELSummary",float_format:t.format(".2f"),countBranchesTested:function(e){return e?e.split(";").length:0},getBranchesWithEvidence:function(e){return n.filter(e,function(e){return e.p<=.05}).length},getTestBranches:function(e){return n.filter(e,function(e){return e.tested>0}).length},getTotalBranches:function(e){return n.keys(e).length},getInitialState:function(){var e=this;return{branches_with_evidence:this.getBranchesWithEvidence(e.props.test_results),test_branches:this.getTestBranches(e.props.test_results),total_branches:this.getTotalBranches(e.props.test_results)}},componentWillReceiveProps:function(e){this.setState({branches_with_evidence:this.getBranchesWithEvidence(e.test_results),test_branches:this.getTestBranches(e.test_results),total_branches:this.getTotalBranches(e.test_results)})},render:function(){var e=this;return s.createElement("ul",{className:"list-group"},s.createElement("li",{className:"list-group-item list-group-item-info"},s.createElement("h3",{className:"list-group-item-heading"},s.createElement("i",{className:"fa fa-list"}),s.createElement("span",{id:"summary-method-name"},"Adaptive branch site REL")," summary"),s.createElement("p",{className:"list-group-item-text lead"},"Evidence",s.createElement("sup",null,"†")," of episodic diversifying selection was found on",s.createElement("strong",null," ",e.state.branches_with_evidence)," out of",s.createElement("span",null," ",e.state.test_branches)," tested branches (",s.createElement("span",null,e.state.total_branches)," total branches)."),s.createElement("p",null,s.createElement("small",null,s.createElement("sup",null,"†"),s.createElement("abbr",{title:"Likelihood Ratio Test"},"LRT")," p ≤ 0.05, corrected for multiple testing.")),s.createElement("p",null,s.createElement("small",null,"Please cite ",s.createElement("a",{href:"http://www.ncbi.nlm.nih.gov/pubmed/25697341",id:"summary-pmid",target:"_blank"},"PMID 25697341")," if you use this result in a publication, presentation, or other scientific work."))))}});e.exports.BSRELSummary=i,e.exports.render_absrel_summary=r}).call(t,a(38),a(41))},205:function(e,t,a){(function(t,n,r){"use strict";function s(e,t){o.render(o.createElement(l,{json:e}),r(t)[0])}function i(e,t){r(t).empty(),s(e,t)}var o=a(44),l=o.createClass({
displayName:"ModelFits",getInitialState:function(){var e=this.getModelRows(this.props.json),t=this.getModelColumns(e);return{table_row_data:e,table_columns:t}},formatRuntime:function(e){var t="",e=parseFloat(e),a=[Math.floor(e/86400),Math.floor(e/3600)%24,Math.floor(e/60)%60,e%60],n=["d.","hrs.","min.","sec."];return a.forEach(function(e,a){e&&(t+=" "+e+" "+n[a])}),t},getLogLikelihood:function(e){return t.format(".2f")(e["log-likelihood"])},getAIC:function(e){return t.format(".2f")(e["AIC-c"])},getNumParameters:function(e){return e.parameters},getBranchLengths:function(e){return e["tree length"]?t.format(".2f")(e["tree length"]):t.format(".2f")(t.values(e["branch-lengths"]).reduce(function(e,t){return e+t},0))},getRuntime:function(e){return this.formatRuntime(e.runtime)},getDistributions:function(e,a){var n={};n[e]={};var r=t.format(".3r"),s=t.format(".2p"),i=(t.format(".4f"),[]);for(var o in a["rate-distributions"]){var l=a["rate-distributions"][o],c=[o,"","",""];n[e][o]=l.map(function(e){return{omega:e[0],weight:e[1]}});for(var m=0;m<l.length;m++)c[m+1]=r(l[m][0])+" ("+s(l[m][1])+")";i.push(c)}return i.sort(function(e,t){return e[0]<t[0]?-1:e[0]==t[0]?0:1}),i},getModelRows:function(e){if(!e)return[];var a=[];t.format(".3r"),t.format(".2p"),t.format(".4f");for(var n in e.fits){var r=[],s=e.fits[n];r=[s["display-order"],"",n,this.getLogLikelihood(s),this.getNumParameters(s),this.getAIC(s),this.getRuntime(s),this.getBranchLengths(s)];var i=this.getDistributions(n,s);if(i.length){r=r.concat(i[0]),r[1]=i[0][0],a.push(r);for(var o=1;o<i.length;o++){var l=r.map(function(e,t){return t?"":e});l[1]=i[o][0];for(var c=l.length-4;c<l.length;c++)l[c]=i[o][c-l.length+4];a.push(l)}}else a.push(r)}return a.sort(function(e,t){return e[0]==t[0]?e[1]<t[1]?-1:e[1]==t[1]?0:1:e[0]-t[0]}),a=a.map(function(e){return e.slice(2)})},getModelColumns:function(e){var a="<th>Model</th>",r="<th><em> log </em>L</th>",s='<th><abbr title="Number of estimated model parameters"># par.</abbr></th>',i='<th><abbr title="Small Sample AIC">AIC<sub>c</sub></abbr></th>',o="<th>Time to fit</th>",l='<th><abbr title="Total tree length, expected substitutions/site">L<sub>tree</sub></abbr></th>',c="<th>Branch set</th>",m="<th>&omega;<sub>1</sub></th>",d="<th>&omega;<sub>2</sub></th>",u="<th>&omega;<sub>3</sub></th>",p=[a,r,s,i,o,l,c,m,d,u];if(0==e.length)return[];var h=n.take(p,e[0].length);t.transpose(e);return h},componentDidUpdate:function(){var e=t.select("#summary-model-header1");e=e.selectAll("th").data(this.state.table_columns),e.enter().append("th"),e.html(function(e){return e});var a=t.select("#summary-model-table").selectAll("tr").data(this.state.table_row_data);a.enter().append("tr"),a.exit().remove(),a=a.selectAll("td").data(function(e){return e}),a.enter().append("td"),a.html(function(e){return e})},componentWillReceiveProps:function(e){var t=this.getModelRows(e.json),a=this.getModelColumns(t);this.setState({table_row_data:t,table_columns:a})},render:function(){return o.createElement("div",{className:"col-lg-12"},o.createElement("ul",{className:"list-group"},o.createElement("li",{className:"list-group-item"},o.createElement("h4",{className:"list-group-item-heading"},o.createElement("i",{className:"fa fa-cubes",styleFormat:"margin-right: 10px"}),"Model fits"),o.createElement("table",{className:"table table-hover table-condensed list-group-item-text",styleFormat:"margin-top:0.5em;"},o.createElement("thead",{id:"summary-model-header1"}),o.createElement("tbody",{id:"summary-model-table"})))))}});e.exports.ModelFits=l,e.exports.render_model_fits=s,e.exports.rerender_model_fits=i}).call(t,a(38),a(41),a(2))},206:function(e,t,a){(function(t,n){"use strict";function r(e,t){i.render(i.createElement(l,{json:e}),n(t)[0])}function s(e,t){n(t).empty(),r(e,t)}var i=a(44),o=a(41),l=i.createClass({displayName:"TreeSummary",getInitialState:function(){var e=this.getSummaryRows(this.props.json),t=this.getTreeSummaryColumns(e);return{table_row_data:e,table_columns:t}},getRateClasses:function(e){var t=o.values(e);return o.countBy(t,function(e){return e.omegas.length})},getBranchProportion:function(e){var a=o.reduce(o.values(e),function(e,t){return e+t});return o.mapObject(e,function(e,n){return t.format(".2p")(e/a)})},getBranchLengthProportion:function(e,a,n){var r=this,s=o.mapObject(e,function(e){return 0});for(var i in a){var l=r.tree.get_node_by_name(i);s[a[i].omegas.length]+=r.tree.branch_length()(l)}return o.mapObject(s,function(e,a){return t.format(".2p")(e/n)})},getNumUnderSelection:function(e,t,a){var n=o.mapObject(e,function(e){return 0});for(var r in t)n[t[r].omegas.length]+=a[r].p<=.05;return n},getSummaryRows:function(e){var a=this,n=e;if(!n)return[];var r=o.map(n.fits,function(e){return t.layout.phylotree("body")(e["tree string"])}),s=r[0];a.tree=s;var i=n.fits["Full model"]["tree length"],l=n.fits["Full model"]["branch-annotations"],c=n["test results"],m=this.getRateClasses(l),d=this.getBranchProportion(m),u=this.getBranchLengthProportion(m,l,i),p=this.getNumUnderSelection(m,l,c),h=o.keys(m),f=o.zip(h,o.values(m),o.values(d),o.values(u),o.values(p));return f.sort(function(e,t){return e[0]==t[0]?e[1]<t[1]?-1:e[1]==t[1]?0:1:e[0]-t[0]}),f},getTreeSummaryColumns:function(e){var t="<th>ω rate<br>classes</th>",a="<th># of <br>branches</th>",n="<th>% of <br>branches</th>",r="<th>% of tree <br>length</th>",s="<th># under <br>selection</th>",i=[t,a,n,r,s];if(0==e.length)return[];var l=o.take(i,e[0].length);return l},componentWillReceiveProps:function(e){var t=this.getSummaryRows(e.json),a=this.getTreeSummaryColumns(t);this.setState({table_row_data:t,table_columns:a})},componentDidUpdate:function(){t.select("#summary-tree-header").empty();var e=t.select("#summary-tree-header");e=e.selectAll("th").data(this.state.table_columns),e.enter().append("th"),e.html(function(e){return e});var a=t.select("#summary-tree-table").selectAll("tr").data(this.state.table_row_data);a.enter().append("tr"),a.exit().remove(),a=a.selectAll("td").data(function(e){return e}),a.enter().append("td"),a.html(function(e){return e})},render:function(){return i.createElement("ul",{className:"list-group"},i.createElement("li",{className:"list-group-item"},i.createElement("h4",{className:"list-group-item-heading"},i.createElement("i",{className:"fa fa-tree"}),"Tree"),i.createElement("table",{className:"table table-hover table-condensed list-group-item-text"},i.createElement("thead",{id:"summary-tree-header"}),i.createElement("tbody",{id:"summary-tree-table"}))))}});e.exports.TreeSummary=l,e.exports.render_tree_summary=r,e.exports.rerender_tree_summary=s}).call(t,a(38),a(2))},207:function(e,t,a){(function(t,n,r){"use strict";function s(e,t,a){return o.render(o.createElement(c,{json:e,settings:a}),r(t)[0])}function i(e,t,a){return r(t).empty(),s(e,a)}var o=a(44),l=a(37);a(208);var c=o.createClass({displayName:"Tree",getInitialState:function(){return{json:this.props.json,settings:this.props.settings}},sortNodes:function(e){var a=this;a.tree.traverse_and_compute(function(e){var a=1;e.children&&e.children.length&&(a+=t.max(e.children,function(e){return e.count_depth})),e.count_depth=a}),a.tree.resort_children(function(t,a){return(t.count_depth-a.count_depth)*(e?1:-1)})},getBranchLengths:function(){var e=this;if(!this.state.json)return[];var t=e.settings["tree-options"]["hyphy-tree-branch-lengths"][0]?this.state.json.fits[this.which_model]["branch-lengths"]:null;if(!t){var a=n.filter(e.tree.get_nodes(),function(e){return e.parent});t=n.object(n.map(a,function(e){return e.name}),n.map(a,function(e){return parseFloat(e.attribute)}))}return t},assignBranchAnnotations:function(){this.state.json&&this.state.json.fits[this.which_model]&&this.tree.assign_attributes(this.state.json.fits[this.which_model]["branch-annotations"])},renderDiscreteLegendColorScheme:function(e){var a=this,n=a.svg,r=a.settings["tree-options"]["hyphy-tree-fill-color"][0]?"black":"red",s={bottom:30,top:15,left:40,right:2};t.selectAll("#color-legend").remove();var i=n.append("g").attr("id","color-legend").attr("class","dc-legend").attr("transform","translate("+s.left+","+s.top+")"),o=i.append("g").attr("class","dc-legend-item").attr("transform","translate(0,0)");o.append("rect").attr("width","13").attr("height","13").attr("fill",r),o.append("text").attr("x","15").attr("y","11").text("Foreground");var l=i.append("g").attr("class","dc-legend-item").attr("transform","translate(0,18)");l.append("rect").attr("width","13").attr("height","13").attr("fill","gray"),l.append("text").attr("x","15").attr("y","11").text("Background")},renderLegendColorScheme:function(e,a,n){var s=this,i=this.state.json.fits[this.which_model]["branch-annotations"],o=s.svg;if(t.selectAll(".legend-definitions").selectAll("linearGradient").remove(),t.selectAll("#color-legend").remove(),i&&!n){var l=70,c=300,m={bottom:30,top:15,left:40,right:2},d=o.append("defs").attr("class","legend-definitions").append("linearGradient").attr("id","_omega_bar").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),u=t.scale.pow().exponent(this.scaling_exponent).domain(t.extent(s.omega_color.domain())).range([0,1]),p=t.scale.pow().exponent(this.scaling_exponent).domain(t.extent(s.omega_color.domain())).range([0,c-m.top-m.bottom]);s.omega_color.domain().forEach(function(e){d.append("stop").attr("offset",""+100*u(e)+"%").style("stop-color",s.omega_color(e))});var h=o.append("g").attr("id","color-legend").attr("transform","translate("+m.left+","+m.top+")");h.append("rect").attr("x",0).attr("width",l-m.left-m.right).attr("y",0).attr("height",c-m.top-m.bottom).style("fill","url(#_omega_bar)");var f=t.svg.axis().scale(p).orient("left").tickFormat(t.format(".1r")).tickValues([0,.01,.1,.5,1,2,5,10]),g=h.append("g");g.style("font-size","14").attr("class","hyphy-omega-bar").call(f),g.selectAll("text").style("text-anchor","right");var v="",b=v=g.append("g").attr("class","hyphy-omega-bar");b=b.selectAll("text").data([a]),b.enter().append("text"),b.text(function(e){return r("<textarea />").html(e).text()}).attr("transform","translate("+.5*(l-m.left-m.right)+","+(c-m.bottom)+")").style("text-anchor","middle").style("font-size","18").attr("dx","0.0em").attr("dy","0.1em")}},setHandlers:function(){var e=this;r("#hyphy-error-hide").on("click",function(e){t.select("#hyphy-error").style("display","none"),e.preventDefault()}),r(".hyphy-tree-trigger").on("click",function(t){e.renderTree()}),r(".tree-tab-btn").on("click",function(t){e.tree.placenodes().update()}),r("#export-phylo-svg").on("click",function(e){l.save_image("svg","#tree_container")}),r("#export-phylo-png").on("click",function(e){l.save_image("png","#tree_container")}),r("#export-phylo-nwk").on("click",function(t){var a=e.tree.get_newick(function(){}),n=document.createElement("a");n.setAttribute("href","data:text/octet-stream;charset=utf-8,"+encodeURIComponent(a)),n.setAttribute("download","nwk.txt"),r("body").append(n),n.click(),n.remove()})},setTreeHandlers:function(){var e=this,t=e.tree;r("[data-direction]").on("click",function(e){var a="vertical"==r(this).data("direction")?t.spacing_x:t.spacing_y;a(a()+ +r(this).data("amount")).update()}),r(".phylotree-layout-mode").on("change",function(e){r(this).is(":checked")&&t.radial()!=("radial"==r(this).data("mode"))&&t.radial(!t.radial()).placenodes().update()}),r(".phylotree-align-toggler").on("change",function(e){r(this).is(":checked")&&t.align_tips("right"==r(this).data("align"))&&t.placenodes().update()}),r("#sort_original").on("click",function(e){t.resort_children(function(e,t){return e.original_child_order-t.original_child_order}),e.preventDefault()}),r("#sort_ascending").on("click",function(t){e.sortNodes(!0),t.preventDefault()}),r("#sort_descending").on("click",function(t){e.sortNodes(!1),t.preventDefault()})},setPartitionList:function(){var e=this;if(!e.props.json.partition)return t.select("#hyphy-tree-highlight-div").style("display","none"),void t.select("#hyphy-tree-highlight").style("display","none");e.tree.set_partitions(e.props.json.partition);var a=t.select("#hyphy-tree-highlight-branches").selectAll("li").data([["None"]].concat(t.keys(e.props.json.partition).map(function(e){return[e]}).sort()));a.enter().append("li"),a.exit().remove(),a=a.selectAll("a").data(function(e){return e}),a.enter().append("a"),a.attr("href","#").on("click",function(a,n){t.select("#hyphy-tree-highlight").attr("value",a),e.renderTree()}),a.text(function(e){return"RELAX.test"==e&&this.click(),e})},setModelList:function(){var e=this;if(!this.state.json)return[];this.state.settings["suppress-tree-render"]=!0;var a=!1,n=t.select("#hyphy-tree-model-list").selectAll("li").data(t.keys(this.state.json.fits).map(function(e){return[e]}).sort());n.enter().append("li"),n.exit().remove(),n=n.selectAll("a").data(function(e){return e}),n.enter().append("a"),n.attr("href","#").on("click",function(a,n){t.select("#hyphy-tree-model").attr("value",a),e.renderTree()}),n.text(function(e){return"General Descriptive"==e&&(a=!0,this.click()),a||"Alternative"!=e||(a=!0,this.click()),a||"Partitioned MG94xREV"!=e||(a=!0,this.click()),a||"MG94"!=e||(a=!0,this.click()),a||"Full model"!=e||(a=!0,this.click()),e}),this.settings["suppress-tree-render"]=!1},initialize:function(){if(this.settings=this.state.settings,!this.settings)return null;if(!this.state.json)return null;r("#hyphy-tree-branch-lengths").click(),this.scaling_exponent=.33,this.omega_format=t.format(".3r"),this.prop_format=t.format(".2p"),this.fit_format=t.format(".2f"),this.p_value_format=t.format(".4f");this.state.json;this.width=800,this.height=600,this.which_model=this.settings["tree-options"]["hyphy-tree-model"][0],this.legend_type=this.settings["hyphy-tree-legend-type"],this.setHandlers(),this.setModelList(),this.initializeTree(),this.setPartitionList()},initializeTree:function(){var e=this,a=e.state.json,n=this.width,r=this.height;this.tree||(this.tree=t.layout.phylotree("body").size([r,n]).separation(function(e,t){return 0})),this.setTreeHandlers(),t.select("#tree_container").html(""),this.svg=t.select("#tree_container").append("svg").attr("width",n).attr("height",r),this.tree.branch_name(null),this.tree.node_span("equal"),this.tree.options({"draw-size-bubbles":!1,selectable:!1,"left-right-spacing":"fit-to-size","left-offset":100,"color-fill":this.settings["tree-options"]["hyphy-tree-fill-color"][0]},!1),this.assignBranchAnnotations(),e.omega_color=t.scale.pow().exponent(this.scaling_exponent).domain([0,.25,1,5,10]).range(this.settings["tree-options"]["hyphy-tree-fill-color"][0]?["#DDDDDD","#AAAAAA","#888888","#444444","#000000"]:["#5e4fa2","#3288bd","#e6f598","#f46d43","#9e0142"]).clamp(!0),e.renderTree(),"discrete"==e.legend_type?e.renderDiscreteLegendColorScheme("tree_container"):e.renderLegendColorScheme("tree_container",a.fits[this.which_model]["annotation-tag"]),this.settings.edgeColorizer&&(this.edgeColorizer=this.settings.edgeColorizer),this.tree.style_edges(this.edgeColorizer),this.tree.style_nodes(this.nodeColorizer),this.tree.spacing_x(30,!0),this.tree.layout(),this.tree.placenodes().update(),this.tree.layout()},renderTree:function(e){var a=this,r=this.state.json,s=a.svg;if(!this.settings["suppress-tree-render"]){var i=!1;for(var o in this.settings["tree-options"])if("hyphy-tree-model"==o){var l=t.select("#"+o),c=l.attr("value")||l.property("checked");c!=this.settings["tree-options"][o][0]&&0!=c&&(this.settings["tree-options"][o][0]=c,i=i||this.settings["tree-options"][o][1])}else{var l=t.select("#"+o),c=l.attr("value")||l.property("checked");c!=this.settings["tree-options"][o][0]&&(this.settings["tree-options"][o][0]=c,i=i||this.settings["tree-options"][o][1])}if(a.which_model!=this.settings["tree-options"]["hyphy-tree-model"][0])return a.which_model=this.settings["tree-options"]["hyphy-tree-model"][0],void a.initializeTree();n.indexOf(n.keys(r),"tree")>-1?this.tree(r.tree).svg(s):this.tree(r.fits[a.which_model]["tree string"]).svg(s),this.branch_lengths=this.getBranchLengths(),this.tree.font_size(18),this.tree.scale_bar_font_size(14),this.tree.node_circle_size(0),this.tree.branch_length(function(e){if(a.branch_lengths)return a.branch_lengths[e.name]||0}),this.assignBranchAnnotations(),n.findKey(r,"partition")?this.partition=(this.settings["tree-options"]["hyphy-tree-highlight"]?r.partition[this.settings["tree-options"]["hyphy-tree-highlight"][0]]:null)||null:this.partition=null,a.omega_color=t.scale.pow().exponent(a.scaling_exponent).domain([0,.25,1,5,10]).range(a.settings["tree-options"]["hyphy-tree-fill-color"][0]?["#DDDDDD","#AAAAAA","#888888","#444444","#000000"]:["#5e4fa2","#3288bd","#e6f598","#f46d43","#9e0142"]).clamp(!0),a.tree.options({"color-fill":a.settings["tree-options"]["hyphy-tree-fill-color"][0]},!1),t.select(".phylotree-definitions").selectAll("linearGradient").remove(),this.settings["tree-options"]["hyphy-tree-hide-legend"][0]?t.select("#color-legend").style("visibility","hidden"):(t.select("#color-legend").style("visibility","visible"),a.legend_type?a.renderDiscreteLegendColorScheme("tree_container"):a.renderLegendColorScheme("tree_container",a.state.json.fits[a.which_model]["annotation-tag"])),e||i&&this.tree.update_layout()}},componentDidMount:function(){this.initialize()},componentWillReceiveProps:function(e){this.setState({json:e.json,settings:e.settings})},componentDidUpdate:function(){this.initialize()},render:function(){return o.createElement("div",null,o.createElement("div",{className:"row"},o.createElement("div",{className:"cold-md-12"},o.createElement("div",{className:"input-group input-group-sm"},o.createElement("div",{className:"input-group-btn"},o.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},"Export",o.createElement("span",{className:"caret"})),o.createElement("ul",{className:"dropdown-menu"},o.createElement("li",{id:"export-phylo-png"},o.createElement("a",{href:"#"},o.createElement("i",{className:"fa fa-image"})," Image")),o.createElement("li",{id:"export-phylo-nwk"},o.createElement("a",{href:"#"},o.createElement("i",{className:"fa fa-file-o"})," Newick File"))),o.createElement("button",{type:"button",className:"btn btn-default btn-sm","data-direction":"vertical","data-amount":"1",title:"Expand vertical spacing"},o.createElement("i",{className:"fa fa-arrows-v"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm","data-direction":"vertical","data-amount":"-1",title:"Compress vertical spacing"},o.createElement("i",{className:"fa  fa-compress fa-rotate-135"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm","data-direction":"horizontal","data-amount":"1",title:"Expand horizonal spacing"},o.createElement("i",{className:"fa fa-arrows-h"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm","data-direction":"horizontal","data-amount":"-1",title:"Compress horizonal spacing"},o.createElement("i",{className:"fa  fa-compress fa-rotate-45"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm",id:"sort_ascending",title:"Sort deepest clades to the bototm"},o.createElement("i",{className:"fa fa-sort-amount-asc"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm",id:"sort_descending",title:"Sort deepsest clades to the top"},o.createElement("i",{className:"fa fa-sort-amount-desc"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm",id:"sort_original",title:"Restore original order"},o.createElement("i",{className:"fa fa-sort"}))),o.createElement("div",{className:"input-group-btn","data-toggle":"buttons"},o.createElement("label",{className:"btn btn-default active btn-sm"},o.createElement("input",{type:"radio",name:"options",className:"phylotree-layout-mode","data-mode":"linear",autoComplete:"off",checked:"",title:"Layout left-to-right"}),"Linear"),o.createElement("label",{className:"btn btn-default  btn-sm"},o.createElement("input",{type:"radio",name:"options",className:"phylotree-layout-mode","data-mode":"radial",autoComplete:"off",title:"Layout radially"})," Radial")),o.createElement("div",{className:"input-group-btn","data-toggle":"buttons"},o.createElement("label",{className:"btn btn-default active btn-sm"},o.createElement("input",{type:"radio",className:"phylotree-align-toggler","data-align":"left",name:"options-align",autoComplete:"off",checked:"",title:"Align tips labels to branches"}),o.createElement("i",{className:"fa fa-align-left"})),o.createElement("label",{className:"btn btn-default btn-sm"},o.createElement("input",{type:"radio",className:"phylotree-align-toggler","data-align":"right",name:"options-align",autoComplete:"off",title:"Align tips labels to the edge of the plot"}),o.createElement("i",{className:"fa fa-align-right"}))),o.createElement("div",{className:"input-group-btn"},o.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},"Model",o.createElement("span",{className:"caret"})),o.createElement("ul",{className:"dropdown-menu",id:"hyphy-tree-model-list"})),o.createElement("input",{type:"text",className:"form-control disabled",id:"hyphy-tree-model",disabled:!0}),o.createElement("div",{id:"hyphy-tree-highlight-div",className:"input-group-btn"},o.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},"Highlight branch set",o.createElement("span",{className:"caret"})),o.createElement("ul",{className:"dropdown-menu",id:"hyphy-tree-highlight-branches"})),o.createElement("input",{type:"text",className:"form-control disabled",id:"hyphy-tree-highlight",disabled:!0}),o.createElement("span",{className:"input-group-addon"},"Use model branch lengths",o.createElement("input",{type:"checkbox",id:"hyphy-tree-branch-lengths",className:"hyphy-tree-trigger"})),o.createElement("span",{className:"input-group-addon"},"Hide legend",o.createElement("input",{type:"checkbox",id:"hyphy-tree-hide-legend",className:"hyphy-tree-trigger"})),o.createElement("span",{className:"input-group-addon"},"Grayscale",o.createElement("input",{type:"checkbox",id:"hyphy-tree-fill-color",className:"hyphy-tree-trigger"}))))),o.createElement("div",{className:"row"},o.createElement("div",{className:"col-md-12"},o.createElement("div",{className:"row"},o.createElement("div",{id:"tree_container",className:"tree-widget"})))))}});e.exports.Tree=c,e.exports.render_tree=s,e.exports.rerender_tree=i}).call(t,a(38),a(41),a(2))},209:function(e,t,a){(function(t,n,r){"use strict";function s(e,t,a,n){l.render(l.createElement(c,{tree:e,test_results:t,annotations:a}),r(n)[0])}function i(e,t,a,n){r(n).empty(),s(e,t,a,n)}var o=a(210),l=a(44),c=l.createClass({displayName:"BranchTable",getInitialState:function(){var e=this.getBranchRows(this.props.tree,this.props.test_results,this.props.annotations),a=this.getBranchColumns(e),n=t.take(t.keys(this.props.annotations)),r=this.props.annotations?this.props.annotations[n].omegas:null,s={dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:15,top:35},legend:!1,domain:[1e-5,1e4],do_log_plot:!0,k_p:null,plot:null,svg_id:"prop-chart"};return{tree:this.props.tree,test_results:this.props.test_results,annotations:this.props.annotations,table_row_data:e,table_columns:a,current_model_name:n,current_omegas:r,distro_settings:s}},getBranchLength:function(e){return this.state.tree?n.format(".4f")(this.state.tree.get_node_by_name(e).attribute):""},getLRT:function(e){var t=n.format(".4f")(e.LRT);return"NaN"==t?e.LRT:t},getPVal:function(e){return n.format(".4f")(e.p)},getUncorrectedPVal:function(e){return n.format(".4f")(e["uncorrected p"])},getOmegaDistribution:function(e,t){if(!t)return"";var a="";for(var r in t[e].omegas){var s=parseFloat(t[e].omegas[r].omega),i="∞";s<1e20&&(i=n.format(".3r")(s)),a+="&omega;<sub>"+(parseInt(r)+1)+"</sub> = "+i+" ("+n.format(".2p")(t[e].omegas[r].prop)+")<br/>"}return a},getBranchRows:function(e,t,a){var r=[];n.format(".3r"),n.format(".2p");for(var s in t){var i=[],o=t[s];i=[s,this.getBranchLength(s),this.getLRT(o),this.getPVal(o),this.getUncorrectedPVal(o),this.getOmegaDistribution(s,a)],r.push(i)}return r.sort(function(e,t){return e[0]==t[0]?e[1]<t[1]?-1:e[1]==t[1]?0:1:e[3]-t[3]}),r},setEvents:function(){var e=this;if(e.state.annotations){var t=n.select("#table-branch-table").selectAll("tr");t.on("click",function(t){var a=t[0];e.setState({current_model_name:a,current_omegas:e.state.annotations[a].omegas})})}},createDistroChart:function(){this.settings={dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:15,top:15},has_zeros:!0,legend_id:null,do_log_plot:!0,k_p:null,plot:null,svg_id:"prop-chart"}},getBranchColumns:function(e){if(e.length<=0)return null;var a="<th>Name</th>",r='<th><abbr title="Branch Length">B</abbr></th>',s='<th><abbr title="Likelihood ratio test statistic">LRT</abbr></th>',i="<th>Test p-value</th>",o="<th>Uncorrected p-value</th>",l="<th>ω distribution over sites</th>",c=[a,r,s,i,o,l],m=t.take(c,e[0].length);n.transpose(e);return m},componentWillReceiveProps:function(e){var a=this.getBranchRows(e.tree,e.test_results,e.annotations),n=this.getBranchColumns(a),r=t.take(t.keys(e.annotations)),s=e.annotations?e.annotations[r].omegas:null,i={dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:15,top:15},legend:!1,domain:[1e-5,1e4],do_log_plot:!0,k_p:null,plot:null,svg_id:"prop-chart"};e.test_results&&e.annotations&&this.setState({tree:e.tree,test_results:e.test_results,annotations:e.annotations,table_row_data:a,table_columns:n,current_model_name:r,current_omegas:s,distro_settings:i})},componentDidUpdate:function(){var e=n.select("#table-branch-header");e=e.selectAll("th").data(this.state.table_columns),e.enter().append("th"),e.html(function(e){return e});var t=n.select("#table-branch-table").selectAll("tr").data(this.state.table_row_data);t.enter().append("tr"),t.exit().remove(),t.style("font-weight",function(e){return e[3]<=.05?"bold":"normal"}),t=t.selectAll("td").data(function(e){return e}),t.enter().append("td"),t.html(function(e){return e}),this.createDistroChart(),this.setEvents()},render:function(){var e=this;return l.createElement("div",{className:"row"},l.createElement("div",{id:"hyphy-branch-table",className:"col-md-7"},l.createElement("table",{className:"table table-hover table-condensed"},l.createElement("thead",{id:"table-branch-header"}),l.createElement("tbody",{id:"table-branch-table"}))),l.createElement("div",{id:"primary-omega-tag",className:"col-md-5"},l.createElement(o.PropChart,{name:e.state.current_model_name,omegas:e.state.current_omegas,settings:e.state.distro_settings})))}});e.exports.BranchTable=c,e.exports.render_branch_table=s,e.exports.rerender_branch_table=i}).call(t,a(41),a(38),a(2))},210:function(e,t,a){(function(t,n,r){"use strict";function s(e,t,a){return o.render(o.createElement(c,{name:e,omegas:t,settings:a}),document.getElementById("primary-omega-tag"))}function i(e,t,a){return r("#primary-omega-tag").empty(),s(e,t,a)}var o=a(44),l=a(37),c=o.createClass({displayName:"PropChart",getDefaultProps:function(){return{svg_id:null,dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:25,top:35},has_zeros:!1,legend_id:null,do_log_plot:!0,k_p:null,plot:null}},getInitialState:function(){return{model_name:this.props.name,omegas:this.props.omegas,settings:this.props.settings}},setEvents:function(){var e=this;t.select("#"+this.save_svg_id).on("click",function(t){l.save_image("svg","#"+e.svg_id)}),t.select("#"+this.save_png_id).on("click",function(t){l.save_image("png","#"+e.svg_id)})},initialize:function(){t.select("#prop-chart").html(""),this.data_to_plot=this.state.omegas,this.svg_id=this.props.settings.svg_id,this.dimensions=this.props.settings.dimensions||this.props.dimensions,this.margins=this.props.settings.margins||this.props.margins,this.legend_id=this.props.settings.legend||this.props.legend_id,this.do_log_plot=this.props.settings.log||this.props.do_log_plot,this.k_p=this.props.settings.k||this.props.k_p;var e=this.props.dimensions,a=this.props.margins;this.props.do_log_plot&&(this.has_zeros=this.data_to_plot.some(function(e){return e.omega<=0})),this.plot_width=e.width-a.left-a.right,this.plot_height=e.height-a.top-a.bottom;var n=this.state.settings.domain;this.omega_scale=(this.do_log_plot?this.has_zeros?t.scale.pow().exponent(.2):t.scale.log():t.scale.linear()).range([0,this.plot_width]).domain(n).nice(),this.proportion_scale=t.scale.linear().range([this.plot_height,0]).domain([-.05,1]).clamp(!0),this.svg=t.select("#"+this.svg_id).attr("width",e.width+a.left+a.right).attr("height",e.height+a.top+a.bottom),this.plot=this.svg.selectAll(".container"),this.svg.selectAll("defs").remove(),this.svg.append("defs").append("marker").attr("id","arrowhead").attr("refX",10).attr("refY",4).attr("markerWidth",10).attr("markerHeight",8).attr("orient","auto").attr("stroke","#000").attr("fill","#000").append("path").attr("d","M 0,0 V8 L10,4 Z"),this.plot.empty()&&(this.plot=this.svg.append("g").attr("class","container")),this.plot.attr("transform","translate("+this.margins.left+" , "+this.margins.top+")"),this.reference_omega_lines=this.plot.selectAll(".hyphy-omega-line-reference"),this.displacement_lines=this.plot.selectAll(".hyphy-displacement-line"),this.createNeutralLine(),this.createXAxis(),this.createYAxis(),this.setEvents(),this.createOmegaLine(this.state.omegas),console.log("initialized everything"),console.log(this.svg)},createOmegaLine:function(e){var t=this;this.data_to_plot;t.colores_g=n.shuffle(["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"]);var a=this.plot.selectAll(".hyphy-omega-line").data(e);a.enter().append("line"),a.exit().remove(),a.transition().attr("x1",function(e){return t.omega_scale(e.omega)}).attr("x2",function(e){return t.omega_scale(e.omega)}).attr("y1",function(e){return t.proportion_scale(-.05)}).attr("y2",function(e){return t.proportion_scale(e.prop)}).style("stroke",function(e){var a=n.take(t.colores_g);return t.colores_g=n.rest(t.colores_g),a}).attr("class","hyphy-omega-line")},createNeutralLine:function(){var e=this,t=this.plot.selectAll(".hyphy-neutral-line").data([1]);t.enter().append("line").attr("class","hyphy-neutral-line"),t.exit().remove(),t.transition().attr("x1",function(t){return e.omega_scale(t)}).attr("x2",function(t){return e.omega_scale(t)}).attr("y1",0).attr("y2",this.plot_height)},createXAxis:function(){var e=t.svg.axis().scale(this.omega_scale).orient("bottom");this.do_log_plot&&e.ticks(10,this.has_zeros?".2r":".1r");var a,n=this.svg.selectAll(".x.axis");n.empty()?(n=this.svg.append("g").attr("class","x hyphy-axis"),a=n.append("g").attr("class","hyphy-axis-label x-label")):a=n.select(".axis-label.x-label"),n.attr("transform","translate("+this.margins.left+","+(this.plot_height+this.margins.top)+")").call(e),a=a.attr("transform","translate("+this.plot_width+","+this.margins.bottom+")").selectAll("text").data(["ω"]),a.enter().append("text"),a.text(function(e){return e}).style("text-anchor","end").attr("dy","0.0em")},createYAxis:function(){var e,a=t.svg.axis().scale(this.proportion_scale).orient("left").ticks(10,".1p"),n=this.svg.selectAll(".y.hyphy-axis");n.empty()?(n=this.svg.append("g").attr("class","y hyphy-axis"),e=n.append("g").attr("class","hyphy-axis-label y-label")):e=n.select(".hyphy-axis-label.y-label"),n.attr("transform","translate("+this.margins.left+","+this.margins.top+")").call(a),e=e.attr("transform","translate("+-this.margins.left+",0)").selectAll("text").data(["Proportion of sites"]),e.enter().append("text"),e.text(function(e){return e}).style("text-anchor","start").attr("dy","-1em")},componentDidMount:function(){try{this.initialize()}catch(e){}},componentWillReceiveProps:function(e){this.setState({model_name:e.name,omegas:e.omegas})},componentDidUpdate:function(){try{this.initialize()}catch(e){}},render:function(){return this.save_svg_id="export-"+this.svg_id+"-svg",this.save_png_id="export-"+this.svg_id+"-png",o.createElement("div",{className:"panel panel-default",id:this.state.model_name
},o.createElement("div",{className:"panel-heading"},o.createElement("h3",{className:"panel-title"},o.createElement("strong",null,this.state.model_name)),o.createElement("p",null,"ω distribution"),o.createElement("div",{className:"btn-group"},o.createElement("button",{id:this.save_svg_id,type:"button",className:"btn btn-default btn-sm"},o.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," SVG"),o.createElement("button",{id:this.save_png_id,type:"button",className:"btn btn-default btn-sm"},o.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," PNG"))),o.createElement("div",{className:"panel-body"},o.createElement("svg",{id:this.svg_id})))}});e.exports.render_prop_chart=s,e.exports.rerender_prop_chart=i,e.exports.PropChart=c}).call(t,a(38),a(41),a(2))},211:function(e,t,a){"use strict";e.exports=a(46)},212:function(e,t,a){(function(t,n){"use strict";function r(e){var a=t.format(".2f"),n=t.format(".2p"),r=t.format(".3r"),s=function(e){var t="";e=parseFloat(e);var a=[Math.floor(e/86400),Math.floor(e/3600)%24,Math.floor(e/60)%60,e%60],n=["d.","hrs.","min.","sec."];return a.forEach(function(e,a){e&&(t+=" "+e+" "+n[a])}),t},i={},o={},c=1,m=0,d=0,u=[];for(var p in e["test results"])i[p]=e["test results"].p,i[p]<=.05&&m++;var h=e.fits["Unconstrained model"]["rate distributions"];for(var f in h){try{u[c][2]=e["test results"][f].LRT,u[c][3]=e["test results"][f].p,u[c][4]=e["test results"][f]["uncorrected p"]}catch(g){}var v=h[f];o[f]=v,c+=1}t.format("g")(e.fits["Unconstrained model"]["tree length"]);u=u.sort(function(e,t){return e[4]-t[4]}),t.select("#summary-test-result").text(e["test results"].p<=.05?"evidence":"no evidence"),t.select("#summary-test-pvalue").text(t.format(".3f")(e["test results"].p)),t.select("#summary-pmid").text("PubMed ID "+e.PMID).attr("href","http://www.ncbi.nlm.nih.gov/pubmed/"+e.PMID),t.select("#summary-total-runtime").text(s(e.timers.overall)),t.select("#summary-total-branches").text(c),t.select("#summary-tested-branches").text(d),t.select("#summary-selected-branches").text(m),has_background=e.background;var b=[[],[]];for(has_background&&b.push([]),k=0;k<2+has_background;k++){var y,_,E=0;if(0===k)y="Unconstrained model",_="FG",b[k].push("Unconstrained Model"),E=0;else if(has_background&&1==k)b[k].push("(background branches)"),_="BG",E=1;else{if(y="Constrained model",!(y in e.fits))break;b[k].push("Constrained Model"),_="FG",E=0}try{for(b[k].push(E?"":a(e.fits[y]["log-likelihood"])),b[k].push(E?"":e.fits[y].parameters),b[k].push(E?"":a(e.fits[y]["AIC-c"])),b[k].push(E?"":s(e.fits[y].runtime)),b[k].push(E?"":a(e.fits[y]["tree length"])),j=0;j<3;j++)b[k].push(r(e.fits[y]["rate distributions"][_][j][0])+" ("+n(e.fits[y]["rate distributions"][_][j][1])+")")}catch(g){l.errorModal(g)}}b=t.select("#summary-model-table").selectAll("tr").data(b),b.enter().append("tr"),b.exit().remove(),b=b.selectAll("td").data(function(e){return e}),b.enter().append("td"),b.html(function(e){return e})}function s(e,a){var r=this;if(0===t.keys(a["evidence ratios"]).length)return t.selectAll(e).style("display","none"),t.selectAll(".dc-data-table").style("display","none"),t.selectAll("#er-thresholds").style("display","none"),void t.selectAll("#apply-thresholds").style("display","none");t.selectAll(e).style("display","block"),t.selectAll(".dc-data-table").style("display","table"),t.selectAll("#er-thresholds").style("display","block"),t.selectAll("#apply-thresholds").style("display","block");var s=a["evidence ratios"].constrained[0];s=s.map(function(e){return Math.log(e)});var c=(a["test set"].split(","),[]);s.forEach(function(e,t){c.push({site_index:t+1,unconstrained:a.profiles.unconstrained[0][t],constrained:a.profiles.constrained[0][t],optimized_null:a.profiles["optimized null"][0][t],er_constrained:Math.log(a["evidence ratios"].constrained[0][t]),er_optimized_null:Math.log(a["evidence ratios"]["optimized null"][0][t])})});var m=i(c),d=m.dimension(function(e){return e.site_index}),u=d.group().reduce(function(e,t){return e.constrained_evidence+=+t.er_constrained,e.optimized_null_evidence+=+t.er_optimized_null,e},function(e,t){return e.constrained_evidence-=+t.er_constrained,e.optimized_null_evidence-=+t.er_optimized_null,e},function(){return{constrained_evidence:0,optimized_null_evidence:0}}),p=d.group().reduce(function(e,t){return e.optimized_null_evidence+=+t.er_optimized_null,e},function(e,t){return e.optimized_null_evidence-=+t.er_optimized_null,e},function(){return{optimized_null_evidence:0}}),h=m.dimension(function(e){return e.er_constrained}),f=m.dimension(function(e){return e.er_optimized_null});r.er_constrained=h,r.er_optimized_null=f;var g=o.compositeChart(e);g.width(n(window).width()).height(300).dimension(d).x(t.scale.linear().domain([1,s.length])).yAxisLabel("2 * Ln Evidence Ratio").xAxisLabel("Site Location").legend(o.legend().x(n(window).width()-150).y(20).itemHeight(13).gap(5)).renderHorizontalGridLines(!0).compose([o.lineChart(g).group(u,"Constrained").colors(t.scale.ordinal().range(["green"])).valueAccessor(function(e){return 2*e.value.constrained_evidence}).keyAccessor(function(e){return e.key}),o.lineChart(g).group(p,"Optimized Null").valueAccessor(function(e){return 2*e.value.optimized_null_evidence}).keyAccessor(function(e){return e.key}).colors(t.scale.ordinal().range(["red"]))]),g.xAxis().ticks(50);var v=t.format(".4f");o.dataTable(".dc-data-table").dimension(d).group(function(e){return d.bottom(1)[0].site_index+" - "+d.top(1)[0].site_index}).size(d.groupAll().reduceCount().value()).columns([function(e){return e.site_index},function(e){return v(e.unconstrained)},function(e){return v(e.constrained)},function(e){return v(e.optimized_null)},function(e){return v(e.er_constrained)},function(e){return v(e.er_optimized_null)}]).sortBy(function(e){return e.site_index}).order(t.ascending).renderlet(function(e){e.selectAll(".dc-table-group").classed("info",!0)}),n("#export-csv").on("click",function(e){l.export_csv_button(d.top(1/0))}),n("#export-chart-svg").on("click",function(e){n("#chart-id").find("svg")[0].setAttribute("class","dc-chart"),l.save_image("svg","#chart-id"),n("#chart-id").find("svg")[0].setAttribute("class","")}),n("#export-chart-png").on("click",function(e){n("#chart-id").find("svg")[0].setAttribute("class","dc-chart"),l.save_image("png","#chart-id"),n("#chart-id").find("svg")[0].setAttribute("class","")}),n("#apply-thresholds").on("click",function(e){var t=document.getElementById("er-constrained-threshold").value,a=document.getElementById("er-optimized-null-threshold").value;r.er_constrained.filter(function(e){return e>=t}),r.er_optimized_null.filter(function(e){return e>=a}),o.renderAll()}),o.renderAll()}a(213);var i=a(215),o=a(218),l=a(37);e.exports.render_summary=r,e.exports.render_histogram=s}).call(t,a(38),a(2))},213:function(e,t){},219:function(e,t){},221:function(e,t,a){(function(t,n,r){"use strict";var s=a(207),i=a(205),o=(a(206),a(210));a(208),a(219);var l=a(44),c=a(211),m=a(37),d=a(212),u=l.createClass({displayName:"BUSTED",float_format:t.format(".2f"),p_value_format:t.format(".4f"),fit_format:t.format(".2f"),loadFromServer:function(){var e=this;t.json(this.props.url,function(t){t.fits["Unconstrained model"]["branch-annotations"]=e.formatBranchAnnotations(t,"Unconstrained model"),t.fits["Constrained model"]["branch-annotations"]=e.formatBranchAnnotations(t,"Constrained model"),t.fits["Unconstrained model"]["rate-distributions"]=t.fits["Unconstrained model"]["rate distributions"],t.fits["Constrained model"]["rate-distributions"]=t.fits["Constrained model"]["rate distributions"],t.fits["Unconstrained model"]["display-order"]=0,t.fits["Constrained model"]["display-order"]=1;var a=t,r="25701167",s="PubMed ID "+r,i="http://www.ncbi.nlm.nih.gov/pubmed/"+r,o=a["test results"].p,l=o<=.05?"evidence":"no evidence",c=a.fits["Unconstrained model"]["rate distributions"].FG,m={omegas:n.map(c,function(e){return n.object(["omega","prop"],e)})};e.setState({p:o,test_result:l,json:a,omegas:m.omegas,pmid_text:s,pmid_href:i})})},getDefaultProps:function(){var e=function(e,t){var a=t.target.annotations.is_foreground,n=this.options()["color-fill"]?"black":"red";e.style("stroke",a?n:"gray").style("stroke-linejoin","round").style("stroke-linejoin","round").style("stroke-linecap","round")},t={omegaPlot:{},"tree-options":{"hyphy-tree-model":["Unconstrained model",!0],"hyphy-tree-highlight":["RELAX.test",!1],"hyphy-tree-branch-lengths":[!0,!0],"hyphy-tree-hide-legend":[!0,!1],"hyphy-tree-fill-color":[!0,!1]},"hyphy-tree-legend-type":"discrete","suppress-tree-render":!1,"chart-append-html":!0,edgeColorizer:e},a={dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:35,top:35},legend:!1,domain:[1e-5,100],do_log_plot:!0,k_p:null,plot:null,svg_id:"prop-chart"};return{distro_settings:a,tree_settings:t,constrained_threshold:"Infinity",null_threshold:"-Infinity",model_name:"FG"}},getInitialState:function(){return{p:null,test_result:null,json:null,omegas:null,pmid_text:null,pmid_href:null}},setEvents:function(){var e=this;r("#json_file").on("change",function(t){var a=t.target.files;if(1==a.length){var s=a[0],i=new FileReader;i.onload=function(t){return function(t){var a=JSON.parse(this.result);a.fits["Unconstrained model"]["branch-annotations"]=e.formatBranchAnnotations(a,"Unconstrained model"),a.fits["Constrained model"]["branch-annotations"]=e.formatBranchAnnotations(a,"Constrained model"),a.fits["Unconstrained model"]["rate-distributions"]=a.fits["Unconstrained model"]["rate distributions"],a.fits["Constrained model"]["rate-distributions"]=a.fits["Constrained model"]["rate distributions"];var r=a,s="25701167",i="PubMed ID "+s,o="http://www.ncbi.nlm.nih.gov/pubmed/"+s,l=r["test results"].p,c=l<=.05?"evidence":"no evidence",m=r.fits["Unconstrained model"]["rate distributions"].FG,d={omegas:n.map(m,function(e){return n.object(["omega","prop"],e)})};e.setState({p:l,test_result:c,json:r,omegas:d.omegas,pmid_text:i,pmid_href:o})}}(s),i.readAsText(s)}r("#datamonkey-absrel-toggle-here").dropdown("toggle"),t.preventDefault()})},formatBranchAnnotations:function(e,a){var r=e["test set"].split(","),s=t.layout.phylotree(),i=s(e.fits[a]["tree string"]).get_nodes(),o=n.map(i,function(e){return e.name}),l=n.object(o,n.map(o,function(e){return{is_foreground:n.indexOf(r,e)>-1}}));return l},initialize:function(){var e=this.state.json;if(e){d.render_histogram("#chart-id",e),t.select("#tree_container").select("svg").remove();var a=e.fits["Unconstrained model"]["rate distributions"].FG;a.map(function(e){return e[0]}),a.map(function(e){return e[1]});r("#export-dist-svg").on("click",function(e){m.save_image("svg","#primary-omega-dist")}),r("#export-dist-png").on("click",function(e){m.save_image("png","#primary-omega-dist")})}},componentWillMount:function(){this.loadFromServer(),this.setEvents()},render:function(){var e=this;return e.initialize(),l.createElement("div",{className:"tab-content"},l.createElement("div",{className:"tab-pane active",id:"summary_tab"},l.createElement("div",{className:"row",styleName:"margin-top: 5px"},l.createElement("div",{className:"col-md-12"},l.createElement("ul",{className:"list-group"},l.createElement("li",{className:"list-group-item list-group-item-info"},l.createElement("h3",{className:"list-group-item-heading"},l.createElement("i",{className:"fa fa-list",styleName:"margin-right: 10px"}),l.createElement("span",{id:"summary-method-name"},"BUSTED")," summary"),"There is ",l.createElement("strong",null,this.state.test_result)," of episodic diversifying selection, with LRT p-value of ",this.state.p,".",l.createElement("p",null,l.createElement("small",null,"Please cite ",l.createElement("a",{href:this.state.pmid_href,id:"summary-pmid"},this.state.pmid_text)," if you use this result in a publication, presentation, or other scientific work.")))))),l.createElement("div",{className:"row"},l.createElement("div",{id:"hyphy-model-fits",className:"col-lg-12"},l.createElement(i.ModelFits,{json:e.state.json}))),l.createElement("button",{id:"export-chart-svg",type:"button",className:"btn btn-default btn-sm pull-right btn-export"},l.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," Export Chart to SVG"),l.createElement("button",{id:"export-chart-png",type:"button",className:"btn btn-default btn-sm pull-right btn-export"},l.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," Export Chart to PNG"),l.createElement("div",{className:"row hyphy-busted-site-table"},l.createElement("div",{id:"chart-id",className:"col-lg-8"},l.createElement("strong",null,"Model Evidence Ratios Per Site"),l.createElement("div",{className:"clearfix"}))),l.createElement("div",{className:"row site-table"},l.createElement("div",{className:"col-lg-12"},l.createElement("form",{id:"er-thresholds"},l.createElement("div",{className:"form-group"},l.createElement("label",{"for":"er-constrained-threshold"},"Constrained Evidence Ratio Threshold:"),l.createElement("input",{type:"text",className:"form-control",id:"er-constrained-threshold",defaultValue:this.props.constrained_threshold})),l.createElement("div",{className:"form-group"},l.createElement("label",{"for":"er-optimized-null-threshold"},"Optimized Null Evidence Ratio Threshold:"),l.createElement("input",{type:"text",className:"form-control",id:"er-optimized-null-threshold",defaultValue:this.props.null_threshold}))),l.createElement("button",{id:"export-csv",type:"button",className:"btn btn-default btn-sm pull-right hyphy-busted-btn-export"},l.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," Export Table to CSV"),l.createElement("button",{id:"apply-thresholds",type:"button",className:"btn btn-default btn-sm pull-right hyphy-busted-btn-export"},"Apply Thresholds"),l.createElement("table",{id:"sites",className:"table sites dc-data-table"},l.createElement("thead",null,l.createElement("tr",{className:"header"},l.createElement("th",null,"Site Index"),l.createElement("th",null,"Unconstrained Likelihood"),l.createElement("th",null,"Constrained Likelihood"),l.createElement("th",null,"Optimized Null Likelihood"),l.createElement("th",null,"Constrained Evidence Ratio"),l.createElement("th",null,"Optimized Null Evidence Ratio"))))))),l.createElement("div",{className:"tab-pane",id:"tree_tab"},l.createElement("div",{className:"col-md-12"},l.createElement(s.Tree,{json:e.state.json,settings:e.props.tree_settings})),l.createElement("div",{className:"col-md-12"},l.createElement("div",{id:"primary-omega-dist",className:"panel-body"},l.createElement(o.PropChart,{name:e.props.model_name,omegas:e.state.omegas,settings:e.props.distro_settings})))))}}),p=function(e,t){c.render(l.createElement(u,{url:e}),document.getElementById(t))};e.exports=p}).call(t,a(38),a(41),a(2))},222:function(e,t,a){(function(t,n){"use strict";function r(e,t){l.render(l.createElement(m,{url:e}),document.getElementById(t))}var s=a(205),i=(a(206),a(207)),o=a(223),l=a(44),c=a(41),m=l.createClass({displayName:"RELAX",float_format:t.format(".2f"),p_value_format:t.format(".4f"),fit_format:t.format(".2f"),loadFromServer:function(){var e=this;t.json(this.props.url,function(t){t.fits["Partitioned MG94xREV"]["branch-annotations"]=e.formatBranchAnnotations(t,"Partitioned MG94xREV"),t.fits["General Descriptive"]["branch-annotations"]=e.formatBranchAnnotations(t,"General Descriptive"),t.fits.Null["branch-annotations"]=e.formatBranchAnnotations(t,"Null"),t.fits.Alternative["branch-annotations"]=e.formatBranchAnnotations(t,"Alternative"),t.fits["Partitioned Exploratory"]["branch-annotations"]=e.formatBranchAnnotations(t,"Partitioned Exploratory");var a=t.fits["Partitioned MG94xREV"]["branch-annotations"],n=t,r=t.PMID,s=t.relaxation_test,i=t["relaxation-test"].p,o=t.fits.Alternative.K>1?"intensification":"relaxation",l=i<=e.props.alpha_level?"significant":"not significant",c=e.p_value_format(i),m=e.fit_format(t["relaxation-test"].LR),d=e.fit_format(t.fits.Alternative.K),u="PubMed ID "+r,p="http://www.ncbi.nlm.nih.gov/pubmed/"+r;e.setState({annotations:a,json:n,pmid:r,test_results:s,p:i,direction:o,evidence:l,pvalue:c,lrt:m,summary_k:d,pmid_text:u,pmid_href:p})})},getDefaultProps:function(){var e=function(e,a){var r=this,s=.33,i=t.format(".3r"),o=t.scale.pow().exponent(s).domain([0,.25,1,5,10]).range(r.options()["color-fill"]?["#DDDDDD","#AAAAAA","#888888","#444444","#000000"]:["#6e4fa2","#3288bd","#e6f598","#f46d43","#9e0142"]).clamp(!0);a.target.annotations?(e.style("stroke",o(a.target.annotations.length)||null),n(e[0][0]).tooltip("destroy"),n(e[0][0]).tooltip({title:i(a.target.annotations.length),html:!0,trigger:"hover",container:"body",placement:"auto"})):(e.style("stroke",null),n(e[0][0]).tooltip("destroy"));var l=n("#hyphy-tree-highlight").attr("value");if(l&&this.get_partitions()){var c=this.get_partitions()[l];e.style("stroke-width",c&&c[a.target.name]?"8":"4").style("stroke-linejoin","round").style("stroke-linecap","round")}};return{edgeColorizer:e,alpha_level:.05}},getInitialState:function(){var e={omegaPlot:{},"tree-options":{"hyphy-tree-model":["Partitioned MG94xREV",!0],"hyphy-tree-highlight":["RELAX.test",!1],"hyphy-tree-branch-lengths":[!0,!0],"hyphy-tree-hide-legend":[!0,!1],"hyphy-tree-fill-color":[!0,!1]},"suppress-tree-render":!1,"chart-append-html":!0,edgeColorizer:this.props.edgeColorizer};return{annotations:null,json:null,pmid:null,settings:e,test_results:null,tree:null,p:null,direction:"unknown",evidence:"unknown",pvalue:null,lrt:null,summary_k:"unknown",pmid_text:"PubMed ID : Unknown",pmid_href:"#",relaxation_K:"unknown"}},componentWillMount:function(){this.loadFromServer(),this.setEvents()},setEvents:function(){var e=this;n("#datamonkey-relax-load-json").on("change",function(t){var a=t.target.files;if(1==a.length){var r=a[0],s=new FileReader;s.onload=function(t){return function(t){var a=JSON.parse(this.result);a.fits["Partitioned MG94xREV"]["branch-annotations"]=e.formatBranchAnnotations(a,"Partitioned MG94xREV"),a.fits["General Descriptive"]["branch-annotations"]=e.formatBranchAnnotations(a,"General Descriptive"),a.fits.Null["branch-annotations"]=e.formatBranchAnnotations(a,"Null"),a.fits.Alternative["branch-annotations"]=e.formatBranchAnnotations(a,"Alternative"),a.fits["Partitioned Exploratory"]["branch-annotations"]=e.formatBranchAnnotations(a,"Partitioned Exploratory");var n=a.fits["Partitioned MG94xREV"]["branch-annotations"],r=a,s=a.PMID,i=a.relaxation_test,o=a["relaxation-test"].p,l=a.fits.Alternative.K>1?"intensification":"relaxation",c=o<=e.props.alpha_level?"significant":"not significant",m=e.p_value_format(o),d=e.fit_format(a["relaxation-test"].LR),u=e.fit_format(a.fits.Alternative.K),p="PubMed ID "+s,h="http://www.ncbi.nlm.nih.gov/pubmed/"+s;e.setState({annotations:n,json:r,pmid:s,test_results:i,p:o,direction:l,evidence:c,pvalue:m,lrt:d,summary_k:u,pmid_text:p,pmid_href:h})}}(r),s.readAsText(r)}n("#datamonkey-absrel-toggle-here").dropdown("toggle"),t.preventDefault()})},formatBranchAnnotations:function(e,t){var a=e.fits[t]["branch-annotations"];a||(a=e.fits[t]["rate distributions"]);var n=c.mapObject(a,function(e,t){return{length:e}});return n},initialize:function(){},render:function(){var e=this;return l.createElement("div",{className:"tab-content"},l.createElement("div",{className:"tab-pane active",id:"datamonkey-relax-summary-tab"},l.createElement("div",{id:"hyphy-relax-summary",className:"row"},l.createElement("div",{className:"col-md-12"},l.createElement("ul",{className:"list-group"},l.createElement("li",{className:"list-group-item list-group-item-info"},l.createElement("h3",{className:"list-group-item-heading"},l.createElement("i",{className:"fa fa-list",styleFormat:"margin-right: 10px"}),l.createElement("span",{id:"summary-method-name"},"RELAX(ed selection test)")," summary"),l.createElement("p",{className:"list-group-item-text lead",styleFormat:"margin-top:0.5em; "},"Test for selection ",l.createElement("strong",{id:"summary-direction"},this.state.direction),"(",l.createElement("abbr",{title:"Relaxation coefficient"},"K")," = ",l.createElement("strong",{id:"summary-K"},this.state.summary_k),") was ",l.createElement("strong",{id:"summary-evidence"},this.state.evidence),"(p = ",l.createElement("strong",{id:"summary-pvalue"},this.state.p),", ",l.createElement("abbr",{title:"Likelihood ratio statistic"},"LR")," = ",l.createElement("strong",{id:"summary-LRT"},this.state.lrt),")"),l.createElement("p",null,l.createElement("small",null,"Please cite ",l.createElement("a",{href:this.state.pmid_href,id:"summary-pmid"},this.state.pmid_text)," if you use this result in a publication, presentation, or other scientific work.")))))),l.createElement("div",{id:"hyphy-model-fits",className:"row"},l.createElement(s.ModelFits,{json:e.state.json})),l.createElement("div",{id:"hyphy-omega-plots",className:"row"},l.createElement(o.OmegaPlotGrid,{json:e.state.json}))),l.createElement("div",{className:"tab-pane",id:"tree-tab"},l.createElement(i.Tree,{json:e.state.json,settings:e.state.settings})))}});e.exports=r}).call(t,a(38),a(2))},223:function(e,t,a){(function(t){"use strict";var n=a(44),r=a(37),s=a(41),i=n.createClass({displayName:"OmegaPlot",getDefaultProps:function(){return{svg_id:null,dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:35,top:35},has_zeros:!1,legend_id:null,do_log_plot:!0,k_p:null,plot:null}},setEvents:function(){var e=this;t.select("#"+this.save_svg_id).on("click",function(t){r.save_image("svg","#"+e.svg_id)}),t.select("#"+this.save_png_id).on("click",function(t){r.save_image("png","#"+e.svg_id)})},initialize:function(){if(this.state.omegas&&this.state.omegas.Reference){var e=this.state.omegas.Reference,a=this.state.omegas.Test;this.svg_id=this.props.settings.svg_id,this.dimensions=this.props.settings.dimensions||this.props.dimensions,this.legend_id=this.props.settings.legend||this.props.legend_id,this.do_log_plot=this.props.settings.log||this.props.do_log_plot,this.k_p=this.props.settings.k||this.props.k_p;var n=this.props.dimensions,r=this.props.margins;this.margins=r,this.do_log_plot&&(this.has_zeros=e.some(function(e){return e.omega<=0}),a&&(this.has_zeros=this.has_zeros||e.some(function(e){return e.omega<=0}))),this.plot_width=n.width-r.left-r.right,this.plot_height=n.height-r.top-r.bottom;var s=this.state.settings.domain||t.extent(a?a.map(function(e){return e.omega}).concat(e.map(function(e){return e.omega})):e.map(function(e){return e.omega}));s[0]*=.5,this.omega_scale=(this.do_log_plot?this.has_zeros?t.scale.pow().exponent(.2):t.scale.log():t.scale.linear()).range([0,this.plot_width]).domain(s).nice(),this.proportion_scale=t.scale.linear().range([this.plot_height,0]).domain([-.05,1]).clamp(!0),this.svg=t.select("#"+this.svg_id).attr("width",n.width).attr("height",n.height),this.plot=this.svg.selectAll(".container"),this.svg.selectAll("defs").remove(),this.svg.append("defs").append("marker").attr("id","arrowhead").attr("refX",10).attr("refY",4).attr("markerWidth",10).attr("markerHeight",8).attr("orient","auto").attr("stroke","#000").attr("fill","#000").append("path").attr("d","M 0,0 V8 L10,4 Z"),this.plot.empty()&&(this.plot=this.svg.append("g").attr("class","container")),this.plot.attr("transform","translate("+this.margins.left+" , "+this.margins.top+")"),this.reference_omega_lines=this.plot.selectAll(".hyphy-omega-line-reference"),this.displacement_lines=this.plot.selectAll(".hyphy-displacement-line"),this.createDisplacementLine(),this.createNeutralLine(),this.createOmegaLine(),this.createReferenceLine(),this.createXAxis(),this.createYAxis(),this.setEvents()}},makeSpring:function(e,a,n,r,s,i){if(e==a)return n=Math.min(n,r),"M"+e+","+(n-40)+"v20";var o=[],l=[e,n],c=Math.atan2(r-n,a-e),s=[s*Math.cos(c),s*Math.sin(c)],m=0;if(Math.abs(e-a)<15)o.push(l);else for(;(e<a&&l[0]<a-15||e>a&&l[0]>a+15)&&(l=l.map(function(e,t){return e+s[t]}),m%2?o.push([l[0],l[1]+i]):o.push([l[0],l[1]-i]),m++,!(m>100)););o.length>1&&o.pop(),o.push([a,r]);var d=t.svg.line().interpolate("monotone");return d(o)},createDisplacementLine:function(){var e=this,t=this.state.omegas.Reference,a=this.state.omegas.Test;if(a){var n=t.map(function(e,t){return{x1:e.omega,x2:a[t].omega,y1:.98*e.weight,y2:.98*a[t].weight}});this.displacement_lines=this.displacement_lines.data(n),this.displacement_lines.enter().append("path"),this.displacement_lines.exit().remove(),this.displacement_lines.transition().attr("d",function(t){return e.makeSpring(e.omega_scale(t.x1),e.omega_scale(t.x2),e.proportion_scale(.5*t.y1),e.proportion_scale(.5*t.y2),5,5)}).attr("marker-end","url(#arrowhead)").attr("class","hyphy-displacement-line")}},createReferenceLine:function(){var e=this.state.omegas.Reference,t=this.state.omegas.Test,a=this;t?(this.reference_omega_lines=this.reference_omega_lines.data(e),this.reference_omega_lines.enter().append("line"),this.reference_omega_lines.exit().remove(),this.reference_omega_lines.transition().attr("x1",function(e){return a.omega_scale(e.omega)}).attr("x2",function(e){return a.omega_scale(e.omega)}).attr("y1",function(e){return a.proportion_scale(-.05)}).attr("y2",function(e){return a.proportion_scale(e.weight)}).style("stroke",function(e){return"#d62728"}).attr("class","hyphy-omega-line-reference")):(this.reference_omega_lines.remove(),this.displacement_lines.remove())},createOmegaLine:function(){var e=this.state.omegas.Reference,t=this.state.omegas.Test,a=this,n=this.plot.selectAll(".hyphy-omega-line").data(t?t:e);n.enter().append("line"),n.exit().remove(),n.transition().attr("x1",function(e){return a.omega_scale(e.omega)}).attr("x2",function(e){return a.omega_scale(e.omega)}).attr("y1",function(e){return a.proportion_scale(-.05)}).attr("y2",function(e){return a.proportion_scale(e.weight)}).style("stroke",function(e){return"#1f77b4"}).attr("class","hyphy-omega-line")},createNeutralLine:function(){var e=this,t=this.plot.selectAll(".hyphy-neutral-line").data([1]);t.enter().append("line").attr("class","hyphy-neutral-line"),t.exit().remove(),t.transition().attr("x1",function(t){return e.omega_scale(t)}).attr("x2",function(t){return e.omega_scale(t)}).attr("y1",0).attr("y2",this.plot_height)},createXAxis:function(){var e=t.svg.axis().scale(this.omega_scale).orient("bottom");this.do_log_plot&&e.ticks(10,this.has_zeros?".2r":".1r");var a,n=this.svg.selectAll(".x.axis");n.empty()?(n=this.svg.append("g").attr("class","x hyphy-axis"),a=n.append("g").attr("class","hyphy-axis-label x-label")):a=n.select(".axis-label.x-label"),n.attr("transform","translate("+this.margins.left+","+(this.plot_height+this.margins.top)+")").call(e),a=a.attr("transform","translate("+this.plot_width+","+this.margins.bottom+")").selectAll("text").data(["ω"]),a.enter().append("text"),a.text(function(e){return e}).style("text-anchor","end").attr("dy","0.0em")},createYAxis:function(){var e,a=t.svg.axis().scale(this.proportion_scale).orient("left").ticks(10,".1p"),n=this.svg.selectAll(".y.hyphy-axis");n.empty()?(n=this.svg.append("g").attr("class","y hyphy-axis"),e=n.append("g").attr("class","hyphy-axis-label y-label")):e=n.select(".hyphy-axis-label.y-label"),n.attr("transform","translate("+this.margins.left+","+this.margins.top+")").call(a),e=e.attr("transform","translate("+-this.margins.left+",0)").selectAll("text").data(["Proportion of sites"]),e.enter().append("text"),e.text(function(e){return e}).style("text-anchor","start").attr("dy","-1em")},getInitialState:function(){return{omegas:this.props.omegas,settings:this.props.settings}},componentWillReceiveProps:function(e){this.setState({omegas:e.omegas})},componentDidUpdate:function(){this.initialize()},componentDidMount:function(){this.initialize()},render:function(){var e=this.props.omegas.key,t=this.props.omegas.label;return this.svg_id=e+"-svg",this.save_svg_id="export-"+e+"-svg",this.save_png_id="export-"+e+"-png",n.createElement("div",{className:"col-lg-6"},n.createElement("div",{className:"panel panel-default",id:e},n.createElement("div",{className:"panel-heading"},n.createElement("h3",{className:"panel-title"},"ω distributions under the ",n.createElement("strong",null,t)," model"),n.createElement("p",null,n.createElement("small",null,"Test branches are shown in ",n.createElement("span",{className:"hyphy-blue"},"blue")," and reference branches are shown in ",n.createElement("span",{className:"hyphy-red"},"red"))),n.createElement("div",{className:"btn-group"},n.createElement("button",{id:this.save_svg_id,type:"button",className:"btn btn-default btn-sm"},n.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," SVG"),n.createElement("button",{id:this.save_png_id,type:"button",className:"btn btn-default btn-sm"},n.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," PNG"))),n.createElement("div",{className:"panel-body"},n.createElement("svg",{id:this.svg_id}))))}}),o=n.createClass({displayName:"OmegaPlotGrid",getInitialState:function(){return{omega_distributions:this.getDistributions(this.props.json)}},componentWillReceiveProps:function(e){this.setState({omega_distributions:this.getDistributions(e.json)})},getDistributions:function(e){var t={};if(!e)return[];for(var a in e.fits){var n=e.fits[a];t[a]={};for(var r in n["rate-distributions"]){var i=n["rate-distributions"][r];t[a][r]=i.map(function(e){return{omega:e[0],weight:e[1]}})}}s.each(t,function(e,t){e.key=t.toLowerCase().replace(/ /g,"-"),e.label=t});var t=s.filter(t,function(e){return s.isObject(e.Reference)});return t},render:function(){var e=s.map(this.state.omega_distributions,function(e,t){var a=t,r=e,s={svg_id:r.key+"-svg",dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:35,top:35},has_zeros:!1,legend_id:null,do_log_plot:!0,k_p:null,plot:null};return n.createElement(i,{name:a,omegas:r,settings:s})});return n.createElement("div",null,e)}});e.exports.OmegaPlot=i,e.exports.OmegaPlotGrid=o}).call(t,a(38))}});
//# sourceMappingURL=hyphyvision.min.js.map